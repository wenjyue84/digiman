
> pelangi-mcp-server@1.0.0 dev
> tsx watch src/index.ts

[DB] Connection string loaded: postgresql://neondb_owner:***@ep-ancient-forest-aeh28zhu-poo...
[IntentConfig] Configuration updated: {
  tiers: {
    tier1_emergency: { enabled: false, contextMessages: 0 },
    tier2_fuzzy: { enabled: false, contextMessages: 3, threshold: 0.8 },
    tier3_semantic: { enabled: false, contextMessages: 5, threshold: 0.67 },
    tier4_llm: { enabled: true, contextMessages: 5 }
  },
  conversationState: {
    trackLastIntent: true,
    trackSlots: true,
    maxHistoryMessages: 20,
    contextTTL: 30
  }
}
[IntentConfig] Loaded tiers from C:\Users\Jyue\Desktop\Projects\PelangiManager-Zeabur\RainbowAI\src\assistant\data\intent-tiers.json
[ConfigStore] âœ… All config files loaded and validated
[Startup] ConfigStore initialized successfully
(node:37688) Warning: SECURITY WARNING: The SSL modes 'prefer', 'require', and 'verify-ca' are treated as aliases for 'verify-full'.
In the next major version (pg-connection-string v3.0.0 and pg v9.0.0), these modes will adopt standard libpq semantics, which have weaker security guarantees.

To prepare for this change:
- If you want the current behavior, explicitly use 'sslmode=verify-full'
- If you want libpq compatibility now, use 'uselibpqcompat=true&sslmode=require'

See https://www.postgresql.org/docs/current/libpq-ssl.html for libpq SSL mode definitions.
(Use `node --trace-warnings ...` to show where the warning was created)
[Hot Reload] Enabled - watching for changes...
Pelangi MCP Server running on http://0.0.0.0:3002
MCP endpoint: http://0.0.0.0:3002/mcp
Health check: http://0.0.0.0:3002/health
API URL: http://localhost:5000
PelangiManager API reachable
[DB] âœ… Database connection established (2794ms)
[Feedback] âœ… Settings loaded from database
[Feedback Settings] âœ… Initialized defaults
[Admin Notifications] âœ… Initialized defaults
[Baileys:default] Loaded 7 LIDâ†’phone mappings from auth state
[BaileysSupervisor] WhatsApp (Baileys) initializing...
[32m[01:04:17] [AdminNotifications] âœ… Initialized[39m
[Assistant] WhatsApp not connected yet â€” handler will be registered for when it connects
[ConfigStore] âœ… All config files loaded and validated
[AI] Provider "Ollama GPT-OSS 20B" (priority 0) â€” ready
[AI] Provider "Groq Llama 3.3 70B" (priority 1) â€” ready
[AI] Provider "Groq Llama 3.1 8B Instant" (priority 2) â€” ready
[AI] Provider "Ollama Gemini 3 Flash" (priority 8) â€” ready
[KnowledgeBase] Loaded 33 KB files from .rainbow-kb/
[KnowledgeBase] Watching .rainbow-kb/ for changes
[KnowledgeBase] Watching .rainbow-kb/memory/ for changes
[StatePersistence] Database available â€” state will be persisted
[Intents] Loaded 18 emergency patterns from regex-patterns.json (by language)
[Intents] Fuzzy matcher initialized with 81 keyword groups
[IntentConfig] Built threshold maps: 35 intents, 0 T2 overrides, 0 T3 overrides
[Semantic] Initializing embedding model...
[Intents] Hybrid mode: Emergency â†’ Fuzzy â†’ Semantic â†’ LLM
[Semantic] Model loaded in 277ms
[Semantic] Computing intent embeddings...
[Semantic] Computed 27 intent embeddings in 2584ms
[Intents] Semantic matcher ready: 27 intents, 838 examples
[StatePersistence] Loaded 1 active conversation state(s) from DB
[Conversations] Restored 1 conversation(s) from database
[WhatsAppManager] Message handler registered
[Assistant] WhatsApp AI Assistant ready
[BaileysSupervisor] Pelangi Assistant initialized â€” WhatsApp auto-reply active
Daily report scheduled for 11:30 AM MYT
API call failed: GET /api/settings Request failed with status code 401
[Knowledge] Failed to refresh settings cache: API Error: No token provided (http://localhost:5000/api/settings â†’ 401 Unauthorized)
{"level":30,"time":"2026-02-14T17:04:20.255Z","pid":37688,"hostname":"DESKTOP-I3D1826","class":"baileys","browser":["PelangiManager","Chrome","1.0.0"],"helloMsg":{"clientHello":{"ephemeral":"S9q4fvCflf89tsSQ9rPiJ+SJ3lZQKezorUCym4IYxGM="}},"msg":"connected to WA"}
{"level":30,"time":"2026-02-14T17:04:20.468Z","pid":37688,"hostname":"DESKTOP-I3D1826","class":"baileys","node":{"username":"60103084289","passive":true,"userAgent":{"platform":"WEB","appVersion":{"primary":2,"secondary":3000,"tertiary":1027934701},"mcc":"000","mnc":"000","osVersion":"0.1","device":"Desktop","osBuildNumber":"0.1","releaseChannel":"RELEASE","localeLanguageIso6391":"en","localeCountryIso31661Alpha2":"US"},"webInfo":{"webSubPlatform":"WEB_BROWSER"},"connectType":"WIFI_UNKNOWN","connectReason":"USER_ACTIVATED","device":2,"pull":true,"lidDbMigrated":false},"msg":"logging in..."}
{"level":30,"time":"2026-02-14T17:04:21.389Z","pid":37688,"hostname":"DESKTOP-I3D1826","class":"baileys","msg":"808 pre-keys found on server"}
{"level":30,"time":"2026-02-14T17:04:21.389Z","pid":37688,"hostname":"DESKTOP-I3D1826","class":"baileys","msg":"Current prekey ID: 812, exists in storage: true"}
{"level":30,"time":"2026-02-14T17:04:21.389Z","pid":37688,"hostname":"DESKTOP-I3D1826","class":"baileys","msg":"PreKey validation passed - Server: 808, Current prekey 812 exists"}
{"level":30,"time":"2026-02-14T17:04:21.720Z","pid":37688,"hostname":"DESKTOP-I3D1826","class":"baileys","msg":"handled 0 offline messages/notifications"}
{"level":30,"time":"2026-02-14T17:04:21.720Z","pid":37688,"hostname":"DESKTOP-I3D1826","class":"baileys","msg":"Connection is now AwaitingInitialSync, buffering events"}
{"level":30,"time":"2026-02-14T17:04:21.720Z","pid":37688,"hostname":"DESKTOP-I3D1826","class":"baileys","msg":"History sync is enabled, awaiting notification with a 20s timeout."}
{"level":30,"time":"2026-02-14T17:04:21.944Z","pid":37688,"hostname":"DESKTOP-I3D1826","class":"baileys","msg":"opened connection to WA"}
[Baileys:default] Connected: Pelangi Capsule Hostel (60103084289)
{"level":30,"time":"2026-02-14T17:04:21.960Z","pid":37688,"hostname":"DESKTOP-I3D1826","class":"baileys","myPN":"60103084289:2@s.whatsapp.net","myLID":"223008241221697:2@lid","msg":"Own LID session created successfully"}
Closing session: SessionEntry {
  _chains: {
    'BU+XAf+uIUjp5OFsq9gS9OE9KFYjEkQiXNFCJWipbT1t': { chainKey: [Object], chainType: 1, messageKeys: {} }
  },
  registrationId: 1492403188,
  currentRatchet: {
    ephemeralKeyPair: {
      pubKey: <Buffer 05 4f 97 01 ff ae 21 48 e9 e4 e1 6c ab d8 12 f4 e1 3d 28 56 23 12 44 22 5c d1 42 25 68 a9 6d 3d 6d>,
      privKey: <Buffer 40 ad 67 a3 4d 11 50 14 c3 cd be df 76 07 6a 72 90 77 9d 4b b5 13 94 28 97 2f b3 04 02 62 68 66>
    },
    lastRemoteEphemeralKey: <Buffer 05 87 4c b8 b2 bb f4 70 0c 1b e3 42 05 b3 a8 27 e4 2d 85 a4 fc 69 71 4c 55 f6 f3 18 50 b3 bb 29 25>,
    previousCounter: 0,
    rootKey: <Buffer 13 62 b4 14 8a 44 a6 bf 80 63 6b 64 69 5a 6b b5 25 57 11 b8 2d 26 fa d2 95 1e 99 97 6b 9e 07 63>
  },
  indexInfo: {
    baseKey: <Buffer 05 64 c5 ba eb d1 a0 9b 85 16 85 44 ba 7c fe 71 55 4f 6b 57 3a f3 93 56 a0 c3 5b 90 39 04 91 88 21>,
    baseKeyType: 1,
    closed: -1,
    used: 1771088137327,
    created: 1771088137327,
    remoteIdentityKey: <Buffer 05 5e 2b d8 d0 cf cc c5 99 0f 2e 74 0a 8d 4e 89 9e d2 9b f8 16 ad dc 36 09 f9 f5 93 de 24 cd 22 1a>
  },
  pendingPreKey: {
    signedKeyId: 5903047,
    baseKey: <Buffer 05 64 c5 ba eb d1 a0 9b 85 16 85 44 ba 7c fe 71 55 4f 6b 57 3a f3 93 56 a0 c3 5b 90 39 04 91 88 21>,
    preKeyId: 92524
  }
}
Closing session: SessionEntry {
  _chains: {
    BQBx05iefgt88Tom9SPBQynh3VNCT9uVvxhOzibUmfEt: { chainKey: [Object], chainType: 1, messageKeys: {} }
  },
  registrationId: 1422521383,
  currentRatchet: {
    ephemeralKeyPair: {
      pubKey: <Buffer 05 00 71 d3 98 9e 7e 0b 7c f1 3a 26 f5 23 c1 43 29 e1 dd 53 42 4f db 95 bf 18 4e ce 26 d4 99 f1 2d>,
      privKey: <Buffer 28 bb dc d7 24 5b fb 13 51 cd 64 6b 0a bc 17 2b cd 18 b1 b2 2b 96 6b f2 46 c1 57 83 39 97 26 6f>
    },
    lastRemoteEphemeralKey: <Buffer 05 89 58 28 35 0c 09 5b 7c bb 31 33 1e d5 2e 8d 45 bf 89 b0 33 8e d3 d5 4f 4e 95 95 cd 01 c7 c7 7c>,
    previousCounter: 0,
    rootKey: <Buffer 25 2b f3 12 1c d9 c8 13 f8 a6 c6 f8 bb 2c a9 dd 57 ba 83 82 cf 97 6c 2e da 9e 41 f8 56 32 65 6b>
  },
  indexInfo: {
    baseKey: <Buffer 05 08 15 06 4b d9 dd b7 03 d1 a7 95 8d 7a 1d a7 83 72 ab ef 21 48 56 83 10 d0 be 54 b1 bc d9 2f 40>,
    baseKeyType: 1,
    closed: -1,
    used: 1771088137331,
    created: 1771088137331,
    remoteIdentityKey: <Buffer 05 bd bc a3 7c 69 c2 11 4d 2a 09 e8 ff a3 d8 7f af 63 30 ee d7 43 25 7a 25 86 ad 46 40 92 c0 66 17>
  },
  pendingPreKey: {
    signedKeyId: 3704918,
    baseKey: <Buffer 05 08 15 06 4b d9 dd b7 03 d1 a7 95 8d 7a 1d a7 83 72 ab ef 21 48 56 83 10 d0 be 54 b1 bc d9 2f 40>,
    preKeyId: 122732
  }
}
Removing old closed session: SessionEntry {
  _chains: {
    'BQ/+uRPlP2IQsTkL230ZJ5VV9pZtLDGnXBQNIVLMFZlz': { chainKey: [Object], chainType: 1, messageKeys: {} }
  },
  registrationId: 1492403188,
  currentRatchet: {
    ephemeralKeyPair: {
      pubKey: <Buffer 05 0f fe b9 13 e5 3f 62 10 b1 39 0b db 7d 19 27 95 55 f6 96 6d 2c 31 a7 5c 14 0d 21 52 cc 15 99 73>,
      privKey: <Buffer 40 25 97 0e 99 3b 98 f6 4d af 06 6c 4f 2e 5d 0c d1 fd ea 1a 7f bd 11 d2 1c 6a 4a d2 50 0c 74 60>
    },
    lastRemoteEphemeralKey: <Buffer 05 87 4c b8 b2 bb f4 70 0c 1b e3 42 05 b3 a8 27 e4 2d 85 a4 fc 69 71 4c 55 f6 f3 18 50 b3 bb 29 25>,
    previousCounter: 0,
    rootKey: <Buffer 80 08 6e 2e 25 ce 31 5b cc 6f 60 db 58 7f 79 75 f5 8a c2 9b d0 b8 e2 2d 11 19 8f af 13 77 dd 8f>
  },
  indexInfo: {
    baseKey: <Buffer 05 79 dc 79 1c f1 dd 33 fd 88 0e bf bc 49 62 dc ce 1a 36 d9 e4 2f 79 2b 19 da ac 3a 84 9b 78 bf 74>,
    baseKeyType: 1,
    closed: 1771080608600,
    used: 1771079730327,
    created: 1771079730327,
    remoteIdentityKey: <Buffer 05 5e 2b d8 d0 cf cc c5 99 0f 2e 74 0a 8d 4e 89 9e d2 9b f8 16 ad dc 36 09 f9 f5 93 de 24 cd 22 1a>
  },
  pendingPreKey: {
    signedKeyId: 5903047,
    baseKey: <Buffer 05 79 dc 79 1c f1 dd 33 fd 88 0e bf bc 49 62 dc ce 1a 36 d9 e4 2f 79 2b 19 da ac 3a 84 9b 78 bf 74>,
    preKeyId: 92475
  }
}
Removing old closed session: SessionEntry {
  _chains: {
    'BXeY03ZVTZPuRolPuAbdqWB1Ai9UuNbc+cC88E/1FGED': { chainKey: [Object], chainType: 1, messageKeys: {} }
  },
  registrationId: 1422521383,
  currentRatchet: {
    ephemeralKeyPair: {
      pubKey: <Buffer 05 77 98 d3 76 55 4d 93 ee 46 89 4f b8 06 dd a9 60 75 02 2f 54 b8 d6 dc f9 c0 bc f0 4f f5 14 61 03>,
      privKey: <Buffer 98 4d 24 9f 40 50 7f ee 54 a4 0e ed d3 19 0c d4 22 8f 2f a7 6f e5 2e 05 5e d9 69 f2 53 60 fe 40>
    },
    lastRemoteEphemeralKey: <Buffer 05 89 58 28 35 0c 09 5b 7c bb 31 33 1e d5 2e 8d 45 bf 89 b0 33 8e d3 d5 4f 4e 95 95 cd 01 c7 c7 7c>,
    previousCounter: 0,
    rootKey: <Buffer 3c c1 7e 71 d5 81 6b ae 8f b8 20 9e 38 13 12 20 c2 90 b4 15 18 25 3f 63 ea 7f 78 cf ff 70 7c 41>
  },
  indexInfo: {
    baseKey: <Buffer 05 d2 c4 3b 6b ff 2e 2d 79 3b 1d 41 75 7b b5 6e 8e df 6f 2f f4 51 46 ca c2 42 da 75 98 6a 16 46 79>,
    baseKeyType: 1,
    closed: 1771080608604,
    used: 1771079730331,
    created: 1771079730331,
    remoteIdentityKey: <Buffer 05 bd bc a3 7c 69 c2 11 4d 2a 09 e8 ff a3 d8 7f af 63 30 ee d7 43 25 7a 25 86 ad 46 40 92 c0 66 17>
  },
  pendingPreKey: {
    signedKeyId: 3704918,
    baseKey: <Buffer 05 d2 c4 3b 6b ff 2e 2d 79 3b 1d 41 75 7b b5 6e 8e df 6f 2f f4 51 46 ca c2 42 da 75 98 6a 16 46 79>,
    preKeyId: 122091
  }
}
[Baileys:default] Sent to 60127088789@s.whatsapp.net: ðŸ”„ *Rainbow MCP Server Started*

Time: 15/02/2026, 1:04:25 a...
[AdminNotifier] Sent server startup notification to +60127088789 (1/3 today)
{"level":40,"time":"2026-02-14T17:04:41.734Z","pid":37688,"hostname":"DESKTOP-I3D1826","class":"baileys","msg":"Timeout in AwaitingInitialSync, forcing state to Online and flushing buffer"}
[Hot Reload] Client connected
[Hot Reload] File changed: C:\Users\Jyue\Desktop\Projects\PelangiManager-Zeabur\RainbowAI\src\public\js\modules\dashboard.js
[Hot Reload] Client disconnected
[Hot Reload] Client connected
[Hot Reload] Client disconnected
(node:37688) [DEP0190] DeprecationWarning: Passing args to a child process with shell option true can lead to security vulnerabilities, as the arguments are not escaped, only concatenated.
[Hot Reload] Client connected
API call failed: GET /api/settings Request failed with status code 401
[Knowledge] Failed to refresh settings cache: API Error: No token provided (http://localhost:5000/api/settings â†’ 401 Unauthorized)
[Hot Reload] File changed: C:\Users\Jyue\Desktop\Projects\PelangiManager-Zeabur\RainbowAI\src\public\js\legacy-functions.js
[Hot Reload] Client disconnected
[Hot Reload] Client connected
[Hot Reload] File changed: C:\Users\Jyue\Desktop\Projects\PelangiManager-Zeabur\RainbowAI\src\public\js\modules\workflows.js
[Hot Reload] Client disconnected
[Hot Reload] Client connected
[Hot Reload] File changed: C:\Users\Jyue\Desktop\Projects\PelangiManager-Zeabur\RainbowAI\src\public\js\core\module-registry.js
[Hot Reload] Client disconnected
[Hot Reload] Client connected
[Hot Reload] File changed: C:\Users\Jyue\Desktop\Projects\PelangiManager-Zeabur\RainbowAI\src\public\js\core\module-registry.js
[Hot Reload] Client disconnected
[Hot Reload] Client connected
API call failed: GET /api/settings Request failed with status code 401
[Knowledge] Failed to refresh settings cache: API Error: No token provided (http://localhost:5000/api/settings â†’ 401 Unauthorized)
[Hot Reload] Client disconnected
[Hot Reload] File changed: C:\Users\Jyue\Desktop\Projects\PelangiManager-Zeabur\RainbowAI\src\public\js\legacy-functions.js
[Hot Reload] Client connected
[Hot Reload] Client disconnected
[Hot Reload] Client connected
