<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Rainbow Admin Dashboard</title>
  <!-- Run first: normalize URL so /understanding ‚Üí /#understanding; strip hot-reload cache-bust param -->
  <script>
    (function () {
      var loc = window.location;
      var path = loc.pathname || '/';
      var hash = loc.hash || '';
      var search = loc.search || '';
      if (path !== '/') {
        // Convert path-based tab URL to hash-based: /understanding ‚Üí /#understanding
        var tabFromPath = hash || '#' + path.slice(1);
        history.replaceState(null, '', loc.origin + '/' + tabFromPath);
      } else if (search.indexOf('_=') !== -1) {
        history.replaceState(null, '', loc.origin + path + hash);
      }
    })();
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: { 50: '#f0f9ff', 100: '#e0f2fe', 200: '#bae6fd', 300: '#7dd3fc', 400: '#38bdf8', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1', 800: '#075985', 900: '#0c4a6e' },
            success: { 50: '#f0fdf4', 100: '#dcfce7', 200: '#bbf7d0', 300: '#86efac', 400: '#4ade80', 500: '#22c55e', 600: '#16a34a', 700: '#15803d', 800: '#166534', 900: '#14532d' },
            warning: { 50: '#fffbeb', 100: '#fef3c7', 200: '#fde68a', 300: '#fcd34d', 400: '#fbbf24', 500: '#f59e0b', 600: '#d97706', 700: '#b45309', 800: '#92400e', 900: '#78350f' },
            danger: { 50: '#fef2f2', 100: '#fee2e2', 200: '#fecaca', 300: '#fca5a5', 400: '#f87171', 500: '#ef4444', 600: '#dc2626', 700: '#b91c1c', 800: '#991b1b', 900: '#7f1d1d' },
            neutral: { 50: '#fafafa', 100: '#f5f5f5', 200: '#e5e5e5', 300: '#d4d4d4', 400: '#a3a3a3', 500: '#737373', 600: '#525252', 700: '#404040', 800: '#262626', 900: '#171717' }
          },
          boxShadow: {
            'soft': '0 2px 8px 0 rgba(0, 0, 0, 0.05)',
            'medium': '0 4px 12px 0 rgba(0, 0, 0, 0.08)',
            'strong': '0 8px 24px 0 rgba(0, 0, 0, 0.12)',
          }
        }
      }
    }
  </script>

  <!-- Rainbow Dashboard Styles -->
  <link rel="stylesheet" href="/public/css/rainbow-styles.css">
</head>

<body class="bg-neutral-50 min-h-screen">

  <!-- Toast Container -->
  <div id="toast-container" class="fixed top-4 right-4 z-50 flex flex-col gap-2"></div>

  <!-- Header -->
  <header class="bg-white border-b shadow-soft">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="text-2xl">üåà</span>
        <h1 class="text-xl font-bold text-neutral-800">Rainbow</h1>
        <span id="wa-badge" class="text-xs px-2 py-0.5 rounded-full bg-neutral-200 text-neutral-600">...</span>
      </div>
      <button onclick="reloadConfig()"
        class="text-sm bg-primary-500 hover:bg-primary-600 text-white px-3 py-1.5 rounded-2xl transition">Reload
        Config</button>
    </div>
  </header>

  <!-- Tabs -->
  <nav class="bg-white border-b">
    <div class="max-w-6xl mx-auto px-4 flex gap-20 items-center py-2">

      <!-- üì± Connect (single choice ‚Üí goes straight to dashboard) -->
      <button
        class="tab-btn flex items-center gap-2 px-4 py-3 text-sm font-semibold text-primary-600 hover:bg-primary-50 rounded-lg transition"
        data-tab="dashboard">
        üì± Connect
      </button>

      <!-- üß† Train Section -->
      <div class="relative">
        <button onclick="toggleDropdown('train-dropdown')"
          class="flex items-center gap-2 px-4 py-3 text-sm font-semibold text-success-600 hover:bg-success-50 rounded-lg transition">
          üß† Train
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>
        <div id="train-dropdown"
          class="hidden absolute top-full left-0 mt-1 bg-white border rounded-lg shadow-lg py-1 z-50 min-w-[200px]">
          <button
            class="tab-btn w-full text-left px-4 py-2 text-sm text-neutral-700 hover:bg-success-50 hover:text-success-600 transition"
            data-tab="understanding" onclick="closeAllDropdowns()">üß† Understanding</button>
          <button
            class="tab-btn w-full text-left px-4 py-2 text-sm text-neutral-700 hover:bg-success-50 hover:text-success-600 transition"
            data-tab="intents" onclick="closeAllDropdowns()">üéØ Smart Routing</button>
          <button
            class="tab-btn w-full text-left px-4 py-2 text-sm text-neutral-700 hover:bg-success-50 hover:text-success-600 transition"
            data-tab="responses" onclick="closeAllDropdowns()">üí¨ Responses</button>
        </div>
      </div>

      <!-- üß™ Test Section -->
      <div class="relative">
        <button onclick="toggleDropdown('test-dropdown')"
          class="flex items-center gap-2 px-4 py-3 text-sm font-semibold text-warning-600 hover:bg-warning-50 rounded-lg transition">
          üß™ Test
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>
        <div id="test-dropdown"
          class="hidden absolute top-full left-0 mt-1 bg-white border rounded-lg shadow-lg py-1 z-50 min-w-[200px]">
          <button
            class="tab-btn w-full text-left px-4 py-2 text-sm text-neutral-700 hover:bg-warning-50 hover:text-warning-600 transition"
            data-tab="chat-simulator" onclick="closeAllDropdowns()">üí¨ Chat Simulator</button>
          <button
            class="tab-btn w-full text-left px-4 py-2 text-sm text-neutral-700 hover:bg-warning-50 hover:text-warning-600 transition"
            data-tab="testing" onclick="closeAllDropdowns()">üß™ Automated Tests</button>
        </div>
      </div>

      <!-- üí¨ Chat (Standalone ‚Äî customer support) -->
      <button
        class="tab-btn flex items-center gap-2 px-4 py-3 text-sm font-semibold text-teal-600 hover:bg-teal-50 rounded-lg transition"
        data-tab="live-chat">
        üí¨ Chat
      </button>

      <!-- üìä Monitor Section -->
      <div class="relative">
        <button onclick="toggleDropdown('monitor-dropdown')"
          class="flex items-center gap-2 px-4 py-3 text-sm font-semibold text-neutral-600 hover:bg-neutral-50 rounded-lg transition">
          üìä Monitor
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>
        <div id="monitor-dropdown"
          class="hidden absolute top-full left-0 mt-1 bg-white border rounded-lg shadow-lg py-1 z-50 min-w-[200px]">
          <button
            class="tab-btn w-full text-left px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-50 hover:text-neutral-600 transition"
            data-tab="performance" onclick="closeAllDropdowns()">üìä Performance</button>
          <button
            class="tab-btn w-full text-left px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-50 hover:text-neutral-600 transition"
            data-tab="settings" onclick="closeAllDropdowns()">‚öôÔ∏è Settings</button>
        </div>
      </div>

      <!-- ‚ùì Help Section (Standalone) -->
      <button class="tab-btn px-4 py-3 text-sm font-semibold text-purple-600 hover:bg-purple-50 rounded-lg transition"
        data-tab="help">
        ‚ùì Help
      </button>
    </div>
  </nav>

  <!-- Content -->
  <main class="max-w-6xl mx-auto px-4 py-6">

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- Dashboard Tab (NEW - Default Landing Page) -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <section id="tab-dashboard" class="tab-content" data-template="dashboard">
      <div class="p-8 text-center">
        <div class="spinner mx-auto"></div>
        <p class="text-sm text-neutral-500 mt-2">Loading dashboard...</p>
      </div>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- WhatsApp Accounts Tab (REMOVED ‚Äî redirects to Dashboard) -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <section id="tab-whatsapp-accounts" class="tab-content hidden">
      <div class="max-w-lg mx-auto py-16 text-center">
        <div class="text-5xl mb-4">üì±</div>
        <h2 class="text-xl font-bold text-neutral-800 mb-2">Page Removed</h2>
        <p class="text-sm text-neutral-500 mb-6">The WhatsApp Accounts page has been removed. WhatsApp connection status
          is now shown on the <strong>Dashboard</strong>, and QR pairing is available at
          <code>/admin/whatsapp-qr</code>.
        </p>
        <div class="flex gap-3 justify-center">
          <button onclick="loadTab('dashboard')"
            class="bg-primary-500 hover:bg-primary-600 text-white text-sm px-4 py-2 rounded-lg transition">Go to
            Dashboard</button>
          <a href="/admin/whatsapp-qr"
            class="border border-neutral-300 hover:bg-neutral-50 text-neutral-700 text-sm px-4 py-2 rounded-lg transition inline-block">Pair
            WhatsApp (QR)</a>
        </div>
      </div>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- Understanding Tab (Renamed from Intent Manager) -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <section id="tab-understanding" class="tab-content hidden" data-template="understanding">
      <div class="p-8 text-center">
        <div class="spinner mx-auto"></div>
        <p class="text-sm text-neutral-500 mt-2">Loading understanding...</p>
      </div>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- Smart Routing Tab (Renamed from Intents & Routing) -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <section id="tab-intents" class="tab-content hidden" data-template="intents">
      <div class="p-8 text-center">
        <div class="spinner mx-auto"></div>
        <p class="text-sm text-neutral-500 mt-2">Loading smart routing...</p>
      </div>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- Responses Tab (NEW - Merges Static Messages + Workflow) -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <section id="tab-responses" class="tab-content hidden" data-template="responses">
      <div class="p-8 text-center">
        <div class="spinner mx-auto"></div>
        <p class="text-sm text-neutral-500 mt-2">Loading responses...</p>
      </div>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- Chat Simulator Tab (NEW - Merges Preview + Real Chat) -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <section id="tab-chat-simulator" class="tab-content hidden" data-template="chat-simulator">
      <div class="p-8 text-center">
        <div class="spinner mx-auto"></div>
        <p class="text-sm text-neutral-500 mt-2">Loading chat simulator...</p>
      </div>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- Live Chat Tab (Customer Support ‚Äî WhatsApp Web style) -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <section id="tab-live-chat" class="tab-content hidden" data-template="live-chat">
      <div class="p-8 text-center">
        <div class="spinner mx-auto"></div>
        <p class="text-sm text-neutral-500 mt-2">Loading chat...</p>
      </div>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- Performance Tab (NEW - Merges Feedback Stats + Intent Accuracy) -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <section id="tab-performance" class="tab-content hidden" data-template="performance">
      <div class="p-8 text-center">
        <div class="spinner mx-auto"></div>
        <p class="text-sm text-neutral-500 mt-2">Loading performance...</p>
      </div>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- Settings Tab -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <section id="tab-settings" class="tab-content hidden" data-template="settings">
      <div class="p-8 text-center">
        <div class="spinner mx-auto"></div>
        <p class="text-sm text-neutral-500 mt-2">Loading settings...</p>
      </div>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- Automated Tests Tab (Renamed from Testing/Run Tests) -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <section id="tab-testing" class="tab-content hidden" data-template="testing">
      <div class="p-8 text-center">
        <div class="spinner mx-auto"></div>
        <p class="text-sm text-neutral-500 mt-2">Loading automated tests...</p>
      </div>
    </section>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- Help Tab -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <section id="tab-help" class="tab-content hidden" data-template="help">
      <div class="p-8 text-center">
        <div class="spinner mx-auto"></div>
        <p class="text-sm text-neutral-500 mt-2">Loading help...</p>
      </div>
    </section>

  </main>

  <!-- Core Scripts (Regular - global scope, load order matters!) -->
  <script src="/public/js/core/state.js"></script>
  <script src="/public/js/core/utils-global.js"></script>
  <script src="/public/js/core/state-manager.js"></script>
  <script src="/public/js/core/modals.js"></script>
  <script src="/public/js/core/constants.js"></script>

  <!-- Shared Components (loaded before legacy-functions.js and modules) -->
  <script src="/public/js/components/metadata-badges.js"></script>
  <script src="/public/js/components/search-panel.js"></script>

  <!-- Legacy Functions (all onclick handlers from original inline JS) -->
  <script src="/public/js/legacy-functions.js"></script>

  <!-- Tab System (needs functions above to be defined) -->
  <script src="/public/js/core/tabs.js"></script>

  <!-- Extracted modules (Phase 1-5 Complete) -->
  <script type="module">
    // Phase 1: Trivial Loaders
    import { loadWhatsappAccounts } from '/public/js/modules/whatsapp-accounts.js';
    import { loadUnderstanding } from '/public/js/modules/understanding.js';
    import { loadPerformance } from '/public/js/modules/performance.js';

    // Phase 2: Dashboard Helpers
    import {
      restartServer,
      runDashboardProviderSpeedTest,
      initActivityStream,
      disconnectActivityStream,
      toggleActivityExpand
    } from '/public/js/modules/dashboard-helpers.js';

    // Phase 3: Medium Complexity Loaders
    import { loadStaticTemplates } from '/public/js/modules/responses-helpers.js';
    import { switchSimulatorTab } from '/public/js/modules/chat-simulator-helpers.js';
    import { loadResponses } from '/public/js/modules/responses.js';
    import { loadChatSimulator } from '/public/js/modules/chat-simulator.js';

    // Phase 4: Complex Loaders
    import { loadSystemStatus, testAIProvider } from '/public/js/modules/system-status.js';
    import {
      loadDashboard,
      dismissChecklist,
      quickActionAddWhatsApp,
      quickActionTrainIntent,
      quickActionTestChat,
      refreshDashboard
    } from '/public/js/modules/dashboard.js';

    // Phase 5: Intents & Routing Tab
    import {
      loadIntents,
      changeRouting,
      changeWorkflowId,
      toggleIntent,
      toggleTimeSensitive,
      changeConfidence,
      deleteIntent
    } from '/public/js/modules/intents.js';

    // Phase 6: Routing Templates Module
    import {
      buildSmartestRouting,
      buildPerformanceRouting,
      buildBalancedRouting,
      routingMatchesTemplate,
      getSavedTemplates,
      saveTemplates,
      renderTemplateButtons,
      showIntentsTemplateHelp,
      detectActiveTemplate,
      applyTemplate,
      showSaveTemplateModal,
      submitSaveTemplate,
      deleteTemplate as deleteRoutingTemplate,
      saveCurrentAsCustom
    } from '/public/js/modules/routing-templates.js';

    // Phase 7: Responses CRUD Module
    import {
      editKnowledgeStatic,
      cancelEditKnowledge,
      saveKnowledgeStatic,
      deleteKnowledge,
      showAddKnowledge,
      submitAddKnowledge,
      showGenerateByLLMModal,
      showGenerateByLLMModalWithIntent,
      closeGenerateByLLMModal,
      callGenerateDraft,
      approveGeneratedReply,
      generateAIReply,
      editTemplate,
      cancelEditTemplate,
      saveTemplate,
      deleteTemplate as deleteMessageTemplate,
      showAddTemplate,
      submitAddTemplate
    } from '/public/js/modules/responses-crud.js';

    // Phase 8: WhatsApp Instance Management Module
    import {
      showAddInstance,
      onPhoneInput,
      refreshWhatsAppList,
      submitAddInstance,
      logoutInstance,
      removeInstance
    } from '/public/js/modules/whatsapp-instances.js';

    // Phase 9: Static Replies Filter Module
    import {
      filterStaticReplies,
      filterStaticCategory
    } from '/public/js/modules/responses-filter.js';

    // Expose to global scope (required by tabs.js and onclick handlers)
    window.loadWhatsappAccounts = loadWhatsappAccounts;
    window.loadUnderstanding = loadUnderstanding;
    window.loadPerformance = loadPerformance;
    window.restartServer = restartServer;
    window.runDashboardProviderSpeedTest = runDashboardProviderSpeedTest;
    window.initActivityStream = initActivityStream;
    window.disconnectActivityStream = disconnectActivityStream;
    window.toggleActivityExpand = toggleActivityExpand;
    window.loadStaticTemplates = loadStaticTemplates;
    window.editTemplate = editTemplate;
    window.switchSimulatorTab = switchSimulatorTab;
    window.loadResponses = loadResponses;
    window.loadChatSimulator = loadChatSimulator;
    window.loadSystemStatus = loadSystemStatus;
    window.testAIProvider = testAIProvider;
    window.loadDashboard = loadDashboard;
    window.dismissChecklist = dismissChecklist;
    window.quickActionAddWhatsApp = quickActionAddWhatsApp;
    window.quickActionTrainIntent = quickActionTrainIntent;
    window.quickActionTestChat = quickActionTestChat;
    window.refreshDashboard = refreshDashboard;
    window.loadIntents = loadIntents;
    window.changeRouting = changeRouting;
    window.changeWorkflowId = changeWorkflowId;
    window.toggleIntent = toggleIntent;
    window.toggleTimeSensitive = toggleTimeSensitive;
    window.changeConfidence = changeConfidence;
    window.deleteIntent = deleteIntent;
    window.renderTemplateButtons = renderTemplateButtons;
    window.showIntentsTemplateHelp = showIntentsTemplateHelp;
    window.detectActiveTemplate = detectActiveTemplate;
    window.applyTemplate = applyTemplate;
    window.showSaveTemplateModal = showSaveTemplateModal;
    window.submitSaveTemplate = submitSaveTemplate;
    window.deleteTemplate = deleteRoutingTemplate;  // Routing template deletion
    window.saveCurrentAsCustom = saveCurrentAsCustom;
    // Phase 7: Responses CRUD
    window.editKnowledgeStatic = editKnowledgeStatic;
    window.cancelEditKnowledge = cancelEditKnowledge;
    window.saveKnowledgeStatic = saveKnowledgeStatic;
    window.deleteKnowledge = deleteKnowledge;
    window.showAddKnowledge = showAddKnowledge;
    window.submitAddKnowledge = submitAddKnowledge;
    window.showGenerateByLLMModal = showGenerateByLLMModal;
    window.showGenerateByLLMModalWithIntent = showGenerateByLLMModalWithIntent;
    window.closeGenerateByLLMModal = closeGenerateByLLMModal;
    window.callGenerateDraft = callGenerateDraft;
    window.approveGeneratedReply = approveGeneratedReply;
    window.generateAIReply = generateAIReply;
    window.editTemplate = editTemplate;
    window.cancelEditTemplate = cancelEditTemplate;
    window.saveTemplate = saveTemplate;
    window.deleteMessageTemplate = deleteMessageTemplate;
    window.showAddTemplate = showAddTemplate;
    window.submitAddTemplate = submitAddTemplate;
    // Phase 8: WhatsApp Instance Management
    window.showAddInstance = showAddInstance;
    window.onPhoneInput = onPhoneInput;
    window.refreshWhatsAppList = refreshWhatsAppList;
    window.submitAddInstance = submitAddInstance;
    window.logoutInstance = logoutInstance;
    window.removeInstance = removeInstance;
    // Phase 9: Static Replies Filter
    window.filterStaticReplies = filterStaticReplies;
    window.filterStaticCategory = filterStaticCategory;
  </script>

  <!-- ES6 Module Scripts (deferred - run after all regular scripts) -->
  <script type="module" src="/public/js/modules/testing.js"></script>
  <script type="module" src="/public/js/modules/real-chat.js"></script>
  <script type="module" src="/public/js/modules/live-chat.js"></script>
  <script type="module" src="/public/js/modules/kb-editor.js"></script>
  <script type="module" src="/public/js/modules/settings.js"></script>
  <script type="module" src="/public/js/main.js"></script>

  <!-- Diagnostic Modal -->
  <div id="diagnostic-modal" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center z-40">
    <div class="bg-white rounded-2xl shadow-strong p-6 w-full max-w-lg mx-4">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-bold text-danger-500 flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z">
            </path>
          </svg>
          Diagnostic Summary
        </h3>
        <button onclick="closeModal('diagnostic-modal')" class="text-neutral-400 hover:text-neutral-600 transition">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <div id="diagnostic-content" class="max-h-[60vh] overflow-y-auto space-y-3 mb-6">
        <!-- Errors will be injected here -->
      </div>
      <div class="flex justify-end">
        <button onclick="closeModal('diagnostic-modal')"
          class="bg-neutral-100 hover:bg-neutral-200 text-neutral-700 px-4 py-2 rounded-2xl text-sm font-medium transition">Close</button>
      </div>
    </div>
  </div>

</body>

</html>