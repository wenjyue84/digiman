  <div class="mb-8">
    <div class="flex items-center gap-3 mb-3">
      <span class="text-3xl">ğŸ‘¨â€ğŸ’»</span>
      <h2 class="text-2xl font-bold text-neutral-800">Rainbow AI â€” Developer Reference</h2>
    </div>
    <p class="text-neutral-600">Comprehensive architecture, pipeline internals, API reference, and troubleshooting for developers and AI coding agents</p>
  </div>

  <!-- Phase 5 Developer Changelog (US-018) -->
  <div class="bg-neutral-900 text-green-400 rounded-2xl p-5 mb-6 font-mono text-xs leading-relaxed">
    <div class="flex items-center gap-2 mb-3">
      <span class="text-yellow-400 text-sm font-bold">// Phase 5 Changelog â€” Feb 2026</span>
    </div>
    <div class="space-y-1">
      <div><span class="text-neutral-500">// NEW ROUTES</span></div>
      <div>POST /api/rainbow/testing/run-all â€” programmatic test runner, accepts scenarios[], returns {total,passed,failed,results}</div>
      <div>GET  /api/rainbow/testing/generate-stories â€” converts latest test failures to prd.json user stories</div>
      <div class="mt-2"><span class="text-neutral-500">// NEW INTENTS</span></div>
      <div>capsule_conflict â†’ routing: workflow "capsule_conflict_handling"</div>
      <div>  keywords: "someone is in my capsule", "capsule taken" (en/ms/zh)</div>
      <div class="mt-2"><span class="text-neutral-500">// SCHEMA CHANGES</span></div>
      <div>settings.json: added ocr_provider = {id, model, description}</div>
      <div>schemas.ts: settingsDataSchema.ocr_provider (optional)</div>
      <div class="mt-2"><span class="text-neutral-500">// FRONTEND CHANGES</span></div>
      <div>autotest-execution.js: runScenario() uses /preview/chat for WORKFLOW_COMPLETE (stateful)</div>
      <div>autotest-execution.js: filter "checkin_process" added to runAutotest()</div>
      <div>autotest-scenarios-single.js: 12 new check-in suite scenarios (suite: "checkin_process")</div>
      <div>settings-ai-models.js: renderOcrSettingsCard() â€” OCR model selector</div>
      <div>kb-editor.js: kbTestSend() shows detailed token breakdown in &lt;details&gt;</div>
      <div>live-chat-panels.js: toggleTagFilter/toggleUnitFilter async (await data load on first click)</div>
    </div>
  </div>

  <!-- Dev TOC -->
  <div class="bg-neutral-100 rounded-2xl border border-neutral-200 p-6 mb-6">
    <h3 class="font-semibold text-neutral-800 mb-3">ğŸ“š Quick Navigation</h3>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-2 text-sm">
      <a href="#" class="help-nav-link text-primary-600 hover:text-primary-700 hover:underline"
        data-scroll-to="dev-architecture">â†’ Architecture</a>
      <a href="#" class="help-nav-link text-primary-600 hover:text-primary-700 hover:underline"
        data-scroll-to="dev-pipeline">â†’ Message Pipeline</a>
      <a href="#" class="help-nav-link text-primary-600 hover:text-primary-700 hover:underline"
        data-scroll-to="dev-classification">â†’ Intent Classification</a>
      <a href="#" class="help-nav-link text-primary-600 hover:text-primary-700 hover:underline"
        data-scroll-to="dev-knowledge-base">â†’ Knowledge Base</a>
      <a href="#" class="help-nav-link text-primary-600 hover:text-primary-700 hover:underline"
        data-scroll-to="dev-ai-providers">â†’ AI Provider System</a>
      <a href="#" class="help-nav-link text-primary-600 hover:text-primary-700 hover:underline"
        data-scroll-to="dev-workflows">â†’ Workflow Engine</a>
      <a href="#" class="help-nav-link text-primary-600 hover:text-primary-700 hover:underline"
        data-scroll-to="dev-config">â†’ Config System</a>
      <a href="#" class="help-nav-link text-primary-600 hover:text-primary-700 hover:underline"
        data-scroll-to="dev-mcp-tools">â†’ MCP Tools (19)</a>
      <a href="#" class="help-nav-link text-primary-600 hover:text-primary-700 hover:underline"
        data-scroll-to="dev-admin-api">â†’ Admin API</a>
      <a href="#" class="help-nav-link text-primary-600 hover:text-primary-700 hover:underline"
        data-scroll-to="dev-whatsapp">â†’ WhatsApp (Baileys)</a>
      <a href="#" class="help-nav-link text-primary-600 hover:text-primary-700 hover:underline"
        data-scroll-to="dev-types">â†’ Types & Validation</a>
      <a href="#" class="help-nav-link text-primary-600 hover:text-primary-700 hover:underline"
        data-scroll-to="dev-file-tree">â†’ File Tree Reference</a>
      <a href="#" class="help-nav-link text-primary-600 hover:text-primary-700 hover:underline"
        data-scroll-to="dev-common-tasks">â†’ Common Dev Tasks</a>
      <a href="#" class="help-nav-link text-primary-600 hover:text-primary-700 hover:underline"
        data-scroll-to="dev-troubleshooting">â†’ Troubleshooting</a>
      <a href="#" class="help-nav-link text-primary-600 hover:text-primary-700 hover:underline"
        data-scroll-to="dev-deployment">â†’ Deployment</a>
    </div>
  </div>

  <!-- â•â•â• 1. ARCHITECTURE â•â•â• -->
  <div id="dev-architecture" class="bg-white rounded-2xl border p-6 mb-6">
    <div class="flex items-center gap-2 mb-4">
      <span class="text-2xl">ğŸ—ï¸</span>
      <h3 class="text-xl font-semibold text-neutral-800">Architecture Overview</h3>
    </div>
    <div class="space-y-4 text-sm text-neutral-700">
      <p class="leading-relaxed">
        PelangiManager is a <strong>three-module monorepo</strong>. Each module runs as an independent process with strict import boundaries. They communicate exclusively via HTTP APIs.
      </p>

      <div class="overflow-x-auto">
        <table class="text-sm w-full border border-neutral-200 rounded-lg">
          <thead>
            <tr class="bg-neutral-50">
              <th class="text-left p-2 font-semibold">Module</th>
              <th class="text-left p-2 font-semibold">Port</th>
              <th class="text-left p-2 font-semibold">Framework</th>
              <th class="text-left p-2 font-semibold">Purpose</th>
            </tr>
          </thead>
          <tbody class="text-neutral-700">
            <tr>
              <td class="p-2 border-t font-mono text-xs">client/</td>
              <td class="p-2 border-t">3000</td>
              <td class="p-2 border-t">React 18 + Vite + Tailwind</td>
              <td class="p-2 border-t">Hostel management SPA (check-in, check-out, settings)</td>
            </tr>
            <tr>
              <td class="p-2 border-t font-mono text-xs">server/</td>
              <td class="p-2 border-t">5000</td>
              <td class="p-2 border-t">Express + Drizzle + PostgreSQL</td>
              <td class="p-2 border-t">REST API, DB gateway, auth, KB CRUD</td>
            </tr>
            <tr>
              <td class="p-2 border-t font-mono text-xs">RainbowAI/</td>
              <td class="p-2 border-t">3002</td>
              <td class="p-2 border-t">Express + Baileys + MCP SDK</td>
              <td class="p-2 border-t">WhatsApp AI assistant, admin dashboard, MCP tools</td>
            </tr>
            <tr>
              <td class="p-2 border-t font-mono text-xs">shared/</td>
              <td class="p-2 border-t">â€”</td>
              <td class="p-2 border-t">Drizzle + Zod</td>
              <td class="p-2 border-t">Shared table definitions & validation schemas</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Dashboard Screenshot -->
      <div class="rounded-xl overflow-hidden border border-neutral-200 shadow-soft">
        <img src="/public/images/help/dashboard.png" alt="Rainbow AI Dashboard" class="w-full" loading="lazy">
        <div class="bg-neutral-50 px-3 py-1.5 text-xs text-neutral-500 text-center">Dashboard â€” system status, WhatsApp connection, occupancy metrics</div>
      </div>

      <!-- Import Rules -->
      <div class="bg-gradient-danger rounded-xl p-4 border border-danger-200">
        <p class="font-semibold text-danger-800 mb-2">ğŸš« Import Rules (Strictly Enforced)</p>
        <div class="text-xs text-danger-700 font-mono space-y-1">
          <p>RainbowAI/ â†’ ZERO imports from server/, client/, shared/ (HTTP only)</p>
          <p>client/    â†’ Types from shared/ only (never server/ or RainbowAI/)</p>
          <p>server/    â†’ Types from shared/ only (never client/ or RainbowAI/)</p>
        </div>
      </div>

      <!-- Proxy Config -->
      <div class="bg-neutral-50 rounded-xl p-4 border">
        <p class="font-semibold text-neutral-800 mb-2">ğŸ”€ Vite Proxy Config (vite.config.ts)</p>
        <div class="text-xs font-mono space-y-1 text-neutral-700">
          <p>/api/rainbow-kb/* â†’ port 5000 &nbsp; <span class="text-neutral-500"># KB CRUD (web backend)</span></p>
          <p>/api/rainbow/*    â†’ port 3002 &nbsp; <span class="text-neutral-500"># Rainbow admin API</span></p>
          <p>/api/*            â†’ port 5000 &nbsp; <span class="text-neutral-500"># All other APIs</span></p>
          <p>/objects/*        â†’ port 5000 &nbsp; <span class="text-neutral-500"># File uploads</span></p>
        </div>
      </div>

      <!-- Tech Stack -->
      <div class="bg-gradient-primary rounded-xl p-4 border border-primary-200">
        <p class="font-semibold text-primary-800 mb-2">ğŸ“¦ Tech Stack</p>
        <div class="grid grid-cols-2 gap-2 text-xs text-primary-700">
          <div><strong>Frontend:</strong> React 18 + TypeScript + Vite + Tailwind + shadcn/ui</div>
          <div><strong>State:</strong> TanStack Query + React Hook Form + Zod</div>
          <div><strong>Backend:</strong> Node.js + Express + TypeScript</div>
          <div><strong>Database:</strong> PostgreSQL (Neon) + Drizzle ORM</div>
          <div><strong>Auth:</strong> Passport.js sessions</div>
          <div><strong>AI:</strong> Gemini Flash + Ollama + Groq + OpenRouter</div>
          <div><strong>WhatsApp:</strong> Baileys (direct connection)</div>
          <div><strong>Embeddings:</strong> Xenova/all-MiniLM-L6-v2</div>
          <div><strong>Search:</strong> Fuse.js (fuzzy matching)</div>
          <div><strong>MCP:</strong> @modelcontextprotocol/sdk</div>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• 2. MESSAGE PIPELINE â•â•â• -->
  <div id="dev-pipeline" class="bg-white rounded-2xl border p-6 mb-6">
    <div class="flex items-center gap-2 mb-4">
      <span class="text-2xl">ğŸ”„</span>
      <h3 class="text-xl font-semibold text-neutral-800">Message Pipeline (4 Phases)</h3>
    </div>
    <div class="space-y-4 text-sm text-neutral-700">
      <p class="leading-relaxed">
        Every incoming WhatsApp message flows through a <strong>4-phase pipeline</strong> orchestrated by
        <code class="bg-neutral-100 px-1 rounded text-xs">message-router.ts</code>. Each phase is a separate module in
        <code class="bg-neutral-100 px-1 rounded text-xs">RainbowAI/src/assistant/pipeline/</code>.
      </p>

      <div class="space-y-3">
        <!-- Phase 1 -->
        <div class="bg-blue-50 rounded-xl p-4 border border-blue-200">
          <div class="flex items-center gap-2 mb-2">
            <span class="bg-blue-600 text-white text-xs font-bold px-2 py-0.5 rounded">Phase 1</span>
            <span class="font-semibold text-blue-800">validateAndPrepare()</span>
            <span class="text-xs text-blue-500 font-mono">input-validator.ts</span>
          </div>
          <ul class="text-xs text-blue-700 space-y-1 ml-4 list-disc">
            <li>Validate message format (phone, text, timestamp)</li>
            <li>Detect language (en/ms/zh) via ngram model</li>
            <li>Rate limiting per phone number</li>
            <li>Detect staff commands (prefix <code class="bg-blue-100 px-1 rounded">!</code>)</li>
            <li>Compute sentiment (positive/negative/neutral)</li>
            <li>Load conversation context from memory/DB</li>
          </ul>
        </div>

        <!-- Phase 2 -->
        <div class="bg-purple-50 rounded-xl p-4 border border-purple-200">
          <div class="flex items-center gap-2 mb-2">
            <span class="bg-purple-600 text-white text-xs font-bold px-2 py-0.5 rounded">Phase 2</span>
            <span class="font-semibold text-purple-800">handleActiveStates()</span>
            <span class="text-xs text-purple-500 font-mono">state-executor.ts</span>
          </div>
          <p class="text-xs text-purple-700 mb-2">Handles special conditions that <strong>bypass</strong> normal intent classification:</p>
          <ul class="text-xs text-purple-700 space-y-1 ml-4 list-disc">
            <li><strong>Feedback mode</strong> â€” Guest rating a previous response</li>
            <li><strong>Active workflow</strong> â€” Multi-step booking/escalation in progress</li>
            <li><strong>Booking state</strong> â€” Mid-booking conversation</li>
            <li><strong>Emergency regex</strong> â€” Immediate detection of critical patterns (theft, medical)</li>
          </ul>
          <p class="text-xs text-purple-500 mt-2">If any active state matches, the pipeline short-circuits (skips Phase 3).</p>
        </div>

        <!-- Phase 3 -->
        <div class="bg-green-50 rounded-xl p-4 border border-green-200">
          <div class="flex items-center gap-2 mb-2">
            <span class="bg-green-600 text-white text-xs font-bold px-2 py-0.5 rounded">Phase 3</span>
            <span class="font-semibold text-green-800">classifyAndRoute()</span>
            <span class="text-xs text-green-500 font-mono">intent-classifier.ts</span>
          </div>
          <p class="text-xs text-green-700 mb-2">Runs 4-tier intent classification (see next section) then resolves routing action via <code class="bg-green-100 px-1 rounded">routing.json</code>:</p>
          <div class="text-xs text-green-700 font-mono">
            intent â†’ { action, kb_topic, workflow_id, confidence_threshold }
          </div>
        </div>

        <!-- Phase 4 -->
        <div class="bg-amber-50 rounded-xl p-4 border border-amber-200">
          <div class="flex items-center gap-2 mb-2">
            <span class="bg-amber-600 text-white text-xs font-bold px-2 py-0.5 rounded">Phase 4</span>
            <span class="font-semibold text-amber-800">processAndSend()</span>
            <span class="text-xs text-amber-500 font-mono">response-processor.ts</span>
          </div>
          <ul class="text-xs text-amber-700 space-y-1 ml-4 list-disc">
            <li>Execute action (KB lookup, workflow step, static reply, escalation)</li>
            <li>Verify confidence threshold met</li>
            <li>Translate response to guest's detected language</li>
            <li>Send via WhatsApp (Baileys)</li>
            <li>Log to conversation history</li>
            <li>Track analytics (intent, tier, latency, tokens)</li>
          </ul>
        </div>
      </div>

      <div class="bg-neutral-50 rounded-xl p-4 border mt-2">
        <p class="font-semibold text-neutral-800 mb-2">ğŸ“Š Routing Actions</p>
        <div class="text-xs font-mono space-y-1 text-neutral-700">
          <p><strong>knowledge_base</strong> â€” RAG from .rainbow-kb/ topic files</p>
          <p><strong>workflow</strong>       â€” Multi-step conversation (booking, escalation)</p>
          <p><strong>template</strong>       â€” Predefined static reply (multilingual)</p>
          <p><strong>escalate</strong>       â€” Forward to staff via WhatsApp</p>
          <p><strong>llm_reply</strong>      â€” Free-form AI-generated response</p>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• 3. INTENT CLASSIFICATION â•â•â• -->
  <div id="dev-classification" class="bg-white rounded-2xl border p-6 mb-6">
    <div class="flex items-center gap-2 mb-4">
      <span class="text-2xl">ğŸ¯</span>
      <h3 class="text-xl font-semibold text-neutral-800">4-Tier Intent Classification</h3>
    </div>
    <div class="space-y-4 text-sm text-neutral-700">
      <p class="leading-relaxed">
        Classification runs tiers <strong>sequentially</strong> and stops at the first confident match. This design optimizes for speed â€” most messages resolve at T1/T2 (<1ms) without touching AI.
      </p>

      <!-- Understanding Tab Screenshot -->
      <div class="rounded-xl overflow-hidden border border-neutral-200 shadow-soft">
        <img src="/public/images/help/understanding.png" alt="Understanding Tab â€” Intent Classification Tiers" class="w-full" loading="lazy">
        <div class="bg-neutral-50 px-3 py-1.5 text-xs text-neutral-500 text-center">Understanding tab â€” manage T1 regex, T2 keywords, T3 examples, and T4 LLM settings</div>
      </div>

      <!-- T1 -->
      <div class="bg-red-50 rounded-xl p-4 border border-red-200">
        <div class="flex items-center gap-2 mb-2">
          <span class="bg-red-600 text-white text-xs font-bold px-2 py-0.5 rounded">T1</span>
          <span class="font-semibold text-red-800">Emergency Regex</span>
          <span class="text-xs text-red-500">~0.1ms â€¢ 100% confidence</span>
        </div>
        <p class="text-xs text-red-700 mb-2">File: <code class="bg-red-100 px-1 rounded">intents.json</code> â†’ <code class="bg-red-100 px-1 rounded">emergencyPatterns</code></p>
        <div class="bg-white rounded-lg p-3 border border-red-200">
          <pre class="text-xs font-mono text-red-800 whitespace-pre-wrap">// Hardcoded patterns for critical situations
/theft|steal|rob|curi|mencuri|å·/i      â†’ escalate to manager
/emergency|ambulance|hurt|injured/i     â†’ forward to emergency staff
/fire|kebakaran|ç€ç«/i                  â†’ immediate staff alert</pre>
        </div>
        <p class="text-xs text-red-500 mt-2">Always runs first. Cannot be overridden by other tiers.</p>
      </div>

      <!-- T2 -->
      <div class="bg-blue-50 rounded-xl p-4 border border-blue-200">
        <div class="flex items-center gap-2 mb-2">
          <span class="bg-blue-600 text-white text-xs font-bold px-2 py-0.5 rounded">T2</span>
          <span class="font-semibold text-blue-800">Fuzzy Keyword Matching (Fuse.js)</span>
          <span class="text-xs text-blue-500">~1ms â€¢ Free</span>
        </div>
        <p class="text-xs text-blue-700 mb-2">File: <code class="bg-blue-100 px-1 rounded">fuzzy-matcher.ts</code> + <code class="bg-blue-100 px-1 rounded">intent-keywords.json</code></p>
        <div class="bg-white rounded-lg p-3 border border-blue-200">
          <pre class="text-xs font-mono text-blue-800 whitespace-pre-wrap">// Fuse.js config
{
  threshold: 0.3,        // 0 = exact match, 1 = match anything
  distance: 100,         // Max character distance for fuzzy
  minMatchCharLength: 2  // Minimum chars to match
}

// intent-keywords.json structure
{
  "wifi": {
    "en": ["wifi", "password", "internet", "network", "wi-fi"],
    "ms": ["kata laluan", "wifi", "internet"],
    "zh": ["å¯†ç ", "ç½‘ç»œ", "ä¸Šç½‘"]
  }
}</pre>
        </div>
        <p class="text-xs text-blue-500 mt-2">Handles typos automatically: "pasword" â‰ˆ "password", "wfi" â‰ˆ "wifi"</p>
      </div>

      <!-- T3 -->
      <div class="bg-green-50 rounded-xl p-4 border border-green-200">
        <div class="flex items-center gap-2 mb-2">
          <span class="bg-green-600 text-white text-xs font-bold px-2 py-0.5 rounded">T3</span>
          <span class="font-semibold text-green-800">Semantic Matching (Embeddings)</span>
          <span class="text-xs text-green-500">~50ms â€¢ Free</span>
        </div>
        <p class="text-xs text-green-700 mb-2">File: <code class="bg-green-100 px-1 rounded">semantic-matcher.ts</code> + <code class="bg-green-100 px-1 rounded">intent-examples.json</code></p>
        <div class="bg-white rounded-lg p-3 border border-green-200">
          <pre class="text-xs font-mono text-green-800 whitespace-pre-wrap">// Model: Xenova/all-MiniLM-L6-v2
// Loaded once at startup, cached in memory
// Embeddings computed for all examples in intent-examples.json

// Matching: cosine similarity between user message embedding
//           and pre-computed example embeddings
// Threshold: configurable (default 0.70)

// intent-examples.json structure
{
  "wifi": [
    "what's the wifi password",
    "how do I connect to internet",
    "can I get the network code"
  ]
}</pre>
        </div>
        <p class="text-xs text-green-500 mt-2">Understands meaning: "how much is a bed" â‰ˆ "tell me the price" â‰ˆ "berapa harga". Requires server restart after editing examples.</p>
      </div>

      <!-- T4 -->
      <div class="bg-amber-50 rounded-xl p-4 border border-amber-200">
        <div class="flex items-center gap-2 mb-2">
          <span class="bg-amber-600 text-white text-xs font-bold px-2 py-0.5 rounded">T4</span>
          <span class="font-semibold text-amber-800">LLM Classification</span>
          <span class="text-xs text-amber-500">~100-500ms â€¢ Uses AI tokens</span>
        </div>
        <p class="text-xs text-amber-700 mb-2">File: <code class="bg-amber-100 px-1 rounded">ai-classification.ts</code></p>
        <div class="bg-white rounded-lg p-3 border border-amber-200">
          <pre class="text-xs font-mono text-amber-800 whitespace-pre-wrap">// When T1-T3 all fail:
// 1. Build dynamic system prompt from intent definitions
// 2. Include conversation context (last 10 messages)
// 3. Send to configured AI provider (fallback chain)
// 4. Parse response: { intent, confidence }
// 5. Apply confidence threshold (default 0.60)

// High T4 usage = need more T2 keywords or T3 examples</pre>
        </div>
      </div>

      <!-- Confidence Thresholds -->
      <div class="bg-neutral-50 rounded-xl p-4 border">
        <p class="font-semibold text-neutral-800 mb-2">ğŸ“Š Default Confidence Thresholds</p>
        <div class="grid grid-cols-3 gap-3 text-xs">
          <div class="bg-white rounded-lg p-2 border text-center">
            <p class="font-bold text-blue-700">T2 Fuzzy</p>
            <p class="text-2xl font-bold text-blue-600">0.80</p>
          </div>
          <div class="bg-white rounded-lg p-2 border text-center">
            <p class="font-bold text-green-700">T3 Semantic</p>
            <p class="text-2xl font-bold text-green-600">0.70</p>
          </div>
          <div class="bg-white rounded-lg p-2 border text-center">
            <p class="font-bold text-amber-700">T4 LLM</p>
            <p class="text-2xl font-bold text-amber-600">0.60</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• 4. KNOWLEDGE BASE â•â•â• -->
  <div id="dev-knowledge-base" class="bg-white rounded-2xl border p-6 mb-6">
    <div class="flex items-center gap-2 mb-4">
      <span class="text-2xl">ğŸ“š</span>
      <h3 class="text-xl font-semibold text-neutral-800">Knowledge Base â€” Progressive Loading</h3>
    </div>
    <div class="space-y-4 text-sm text-neutral-700">
      <p class="leading-relaxed">
        File: <code class="bg-neutral-100 px-1 rounded text-xs">knowledge-base.ts</code>.
        Instead of dumping the entire KB into the LLM prompt, Rainbow uses <strong>progressive loading</strong> â€” only loading topic files that match the user's message. This saves 60-70% of tokens.
      </p>

      <div class="bg-gradient-success rounded-xl p-4 border border-success-200">
        <p class="font-semibold text-success-800 mb-2">ğŸ“ KB File Structure</p>
        <div class="text-xs font-mono text-success-700 space-y-1">
          <p><strong>Core files (always loaded):</strong></p>
          <p class="ml-4">.rainbow-kb/AGENTS.md &nbsp;â† System guidelines & rules</p>
          <p class="ml-4">.rainbow-kb/soul.md &nbsp;&nbsp;&nbsp;â† Hostel personality & tone</p>
          <p class="mt-2"><strong>Topic files (loaded on match):</strong></p>
          <p class="ml-4">checkin-wifi.md, checkin-procedure.md, checkin-times.md</p>
          <p class="ml-4">pricing.md, availability.md</p>
          <p class="ml-4">facilities-*.md, rules-*.md</p>
          <p class="ml-4">location.md, transport.md, attractions.md</p>
        </div>
      </div>

      <div class="bg-neutral-50 rounded-xl p-4 border">
        <p class="font-semibold text-neutral-800 mb-2">ğŸ” Topic Selection (guessTopicFiles)</p>
        <div class="bg-white rounded-lg p-3 border">
          <pre class="text-xs font-mono text-neutral-800 whitespace-pre-wrap">// Pattern â†’ Topic Files regex mapping
'wifi|internet|password|ç½‘ç»œ|å¯†ç '    â†’ ['checkin-wifi.md']
'price|cost|rate|berapa|å¤šå°‘é’±'       â†’ ['pricing.md']
'check.?in|arrive|masuk|å…¥ä½'         â†’ ['checkin-procedure.md', 'checkin-times.md']
'facility|pool|gym|laundry|kemudahan'  â†’ ['facilities-amenities.md']
'rule|quiet|smoking|peraturan'         â†’ ['rules-house.md']

// If no patterns match, loads all topic files (fallback)</pre>
        </div>
      </div>

      <div class="bg-gradient-primary rounded-xl p-4 border border-primary-200">
        <p class="font-semibold text-primary-800 mb-2">ğŸ“ RAG Prompt Structure</p>
        <div class="text-xs text-primary-700 space-y-1">
          <p><strong>1.</strong> System guidelines (AGENTS.md)</p>
          <p><strong>2.</strong> Personality & tone (soul.md)</p>
          <p><strong>3.</strong> Relevant topic files (matched via guessTopicFiles)</p>
          <p><strong>4.</strong> Conversation history (last 10 exchanges)</p>
          <p><strong>5.</strong> User message</p>
          <p class="mt-2 text-primary-500">â†’ AI generates response grounded in KB content (not hallucination)</p>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• 5. AI PROVIDER SYSTEM â•â•â• -->
  <div id="dev-ai-providers" class="bg-white rounded-2xl border p-6 mb-6">
    <div class="flex items-center gap-2 mb-4">
      <span class="text-2xl">ğŸ¤–</span>
      <h3 class="text-xl font-semibold text-neutral-800">AI Provider System â€” Multi-Provider Fallback</h3>
    </div>
    <div class="space-y-4 text-sm text-neutral-700">
      <p class="leading-relaxed">
        File: <code class="bg-neutral-100 px-1 rounded text-xs">ai-provider-manager.ts</code>.
        Rainbow supports multiple AI providers with automatic failover. If the primary model is rate-limited or down, it falls to the next enabled provider by priority.
      </p>

      <!-- Settings Screenshot -->
      <div class="rounded-xl overflow-hidden border border-neutral-200 shadow-soft">
        <img src="/public/images/help/settings.png" alt="Settings â€” AI Provider Configuration" class="w-full" loading="lazy">
        <div class="bg-neutral-50 px-3 py-1.5 text-xs text-neutral-500 text-center">Settings tab â€” configure AI providers, priority order, and token budgets</div>
      </div>

      <div class="overflow-x-auto">
        <table class="text-xs w-full border border-neutral-200 rounded-lg">
          <thead>
            <tr class="bg-neutral-50">
              <th class="text-left p-2 font-semibold">Priority</th>
              <th class="text-left p-2 font-semibold">Provider</th>
              <th class="text-left p-2 font-semibold">Model</th>
              <th class="text-left p-2 font-semibold">Speed</th>
              <th class="text-left p-2 font-semibold">Cost</th>
              <th class="text-left p-2 font-semibold">Best For</th>
            </tr>
          </thead>
          <tbody class="text-neutral-700">
            <tr>
              <td class="p-2 border-t font-bold">0</td>
              <td class="p-2 border-t">Google Gemini</td>
              <td class="p-2 border-t font-mono">gemini-2.5-flash</td>
              <td class="p-2 border-t">âš¡âš¡âš¡</td>
              <td class="p-2 border-t text-green-600">Free tier</td>
              <td class="p-2 border-t">Multilingual casual chat</td>
            </tr>
            <tr>
              <td class="p-2 border-t font-bold">1</td>
              <td class="p-2 border-t">Ollama Cloud</td>
              <td class="p-2 border-t font-mono">gemini-3-flash-preview:cloud</td>
              <td class="p-2 border-t">âš¡âš¡</td>
              <td class="p-2 border-t text-green-600">Free</td>
              <td class="p-2 border-t">No API key needed</td>
            </tr>
            <tr>
              <td class="p-2 border-t font-bold">2</td>
              <td class="p-2 border-t">Groq</td>
              <td class="p-2 border-t font-mono">llama-3.3-70b-versatile</td>
              <td class="p-2 border-t">âš¡âš¡</td>
              <td class="p-2 border-t text-green-600">Cheap</td>
              <td class="p-2 border-t">Stable fallback</td>
            </tr>
            <tr>
              <td class="p-2 border-t font-bold">3+</td>
              <td class="p-2 border-t">OpenRouter / NVIDIA</td>
              <td class="p-2 border-t font-mono">varies</td>
              <td class="p-2 border-t">âš¡</td>
              <td class="p-2 border-t">Varies</td>
              <td class="p-2 border-t">Diverse model access</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="bg-neutral-50 rounded-xl p-4 border">
        <p class="font-semibold text-neutral-800 mb-2">âš™ï¸ Provider Config (settings.json)</p>
        <div class="bg-white rounded-lg p-3 border">
          <pre class="text-xs font-mono text-neutral-800 whitespace-pre-wrap">{
  "providers": [
    {
      "id": "google-gemini-flash",
      "type": "google-gemini",        // Provider adapter type
      "api_key_env": "GEMINI_API_KEY", // Env var for API key
      "base_url": "https://generativelanguage.googleapis.com/v1beta",
      "model": "gemini-2.5-flash",
      "enabled": true,
      "priority": 0,                   // Lower = tried first
      "available": true                // Runtime availability flag
    }
  ],
  "max_classify_tokens": 100,   // Token limit for T4 classification
  "max_chat_tokens": 500,       // Token limit for response generation
  "classify_temperature": 0.05, // Low temp for consistent classification
  "chat_temperature": 0.7       // Higher temp for natural responses
}</pre>
        </div>
      </div>

      <div class="bg-gradient-warning rounded-xl p-4 border border-warning-200">
        <p class="font-semibold text-warning-800 mb-2">ğŸ’¡ Token Usage by Tier</p>
        <div class="text-xs text-warning-700 space-y-1">
          <p><strong>T1 (Regex):</strong> 0 tokens â€” pure regex, free</p>
          <p><strong>T2 (Fuzzy):</strong> 0 tokens â€” Fuse.js in-memory, free</p>
          <p><strong>T3 (Semantic):</strong> 0 tokens â€” local embedding model, free</p>
          <p><strong>T4 (LLM Classification):</strong> ~100 tokens â€” cheapest provider</p>
          <p><strong>Response Generation:</strong> ~500 tokens â€” configured provider chain</p>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• 6. WORKFLOW ENGINE â•â•â• -->
  <div id="dev-workflows" class="bg-white rounded-2xl border p-6 mb-6">
    <div class="flex items-center gap-2 mb-4">
      <span class="text-2xl">ğŸ”€</span>
      <h3 class="text-xl font-semibold text-neutral-800">Workflow Engine</h3>
    </div>
    <div class="space-y-4 text-sm text-neutral-700">
      <p class="leading-relaxed">
        File: <code class="bg-neutral-100 px-1 rounded text-xs">workflow-executor.ts</code>.
        Supports two workflow formats: <strong>linear steps</strong> (simple sequential) and <strong>node-based</strong> (branching, API calls, conditions).
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Linear -->
        <div class="bg-blue-50 rounded-xl p-4 border border-blue-200">
          <p class="font-semibold text-blue-800 mb-2">ğŸ“‹ Linear Steps (Simple)</p>
          <div class="bg-white rounded-lg p-3 border border-blue-200">
            <pre class="text-xs font-mono text-blue-800 whitespace-pre-wrap">{
  "id": "booking_workflow",
  "steps": [
    {
      "id": "step1",
      "question": "What dates?",
      "validator": "date_range"
    },
    {
      "id": "step2",
      "question": "How many?",
      "validator": "number"
    }
  ]
}</pre>
          </div>
          <p class="text-xs text-blue-500 mt-2">Sequential: step1 â†’ step2 â†’ done</p>
        </div>

        <!-- Node-based -->
        <div class="bg-purple-50 rounded-xl p-4 border border-purple-200">
          <p class="font-semibold text-purple-800 mb-2">ğŸ¨ Node-Based (Advanced)</p>
          <div class="bg-white rounded-lg p-3 border border-purple-200">
            <pre class="text-xs font-mono text-purple-800 whitespace-pre-wrap">{
  "id": "escalation",
  "startNodeId": "start",
  "nodes": [
    { "id": "start",
      "type": "message",
      "content": "Escalating..." },
    { "id": "api",
      "type": "pelangi_api",
      "endpoint": "/problems" },
    { "id": "notify",
      "type": "whatsapp_send",
      "to": "manager_phone" }
  ]
}</pre>
          </div>
          <p class="text-xs text-purple-500 mt-2">Branching: start â†’ api â†’ notify</p>
        </div>
      </div>

      <div class="bg-neutral-50 rounded-xl p-4 border">
        <p class="font-semibold text-neutral-800 mb-2">ğŸ”§ Available Node Types</p>
        <div class="overflow-x-auto">
          <table class="text-xs w-full border border-neutral-200 rounded-lg">
            <thead>
              <tr class="bg-neutral-50">
                <th class="text-left p-2">Type</th>
                <th class="text-left p-2">Behavior</th>
                <th class="text-left p-2">Example</th>
              </tr>
            </thead>
            <tbody class="text-neutral-700">
              <tr><td class="p-2 border-t font-mono">message</td><td class="p-2 border-t">Send text to guest</td><td class="p-2 border-t">Confirmation, instructions</td></tr>
              <tr><td class="p-2 border-t font-mono">wait_reply</td><td class="p-2 border-t">Pause & wait for guest input</td><td class="p-2 border-t">Collect dates, capsule number</td></tr>
              <tr><td class="p-2 border-t font-mono">condition</td><td class="p-2 border-t">Branch on state/reply</td><td class="p-2 border-t">if "yes" â†’ A, else â†’ B</td></tr>
              <tr><td class="p-2 border-t font-mono">whatsapp_send</td><td class="p-2 border-t">Message specific phone</td><td class="p-2 border-t">Notify staff number</td></tr>
              <tr><td class="p-2 border-t font-mono">pelangi_api</td><td class="p-2 border-t">Call backend API</td><td class="p-2 border-t">Check availability, create booking</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="bg-gradient-primary rounded-xl p-4 border border-primary-200">
        <p class="font-semibold text-primary-800 mb-2">ğŸ”„ Workflow State Lifecycle</p>
        <div class="text-xs text-primary-700 font-mono space-y-1">
          <p>1. Intent matched â†’ createWorkflowState(phone, workflowId)</p>
          <p>2. Step N: Send prompt â†’ Set state to WAITING_REPLY</p>
          <p>3. Guest replies â†’ Validate input</p>
          <p>4a. Valid â†’ Move to step N+1 (or execute node)</p>
          <p>4b. Invalid â†’ Re-prompt step N</p>
          <p>5. Final step complete â†’ workflowState = null</p>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• 7. CONFIG SYSTEM â•â•â• -->
  <div id="dev-config" class="bg-white rounded-2xl border p-6 mb-6">
    <div class="flex items-center gap-2 mb-4">
      <span class="text-2xl">âš™ï¸</span>
      <h3 class="text-xl font-semibold text-neutral-800">Configuration System â€” Atomic Writes</h3>
    </div>
    <div class="space-y-4 text-sm text-neutral-700">
      <p class="leading-relaxed">
        File: <code class="bg-neutral-100 px-1 rounded text-xs">config-store.ts</code>.
        All config files use <strong>atomic write</strong> pattern (write to .tmp, then rename) to prevent corruption on crash.
      </p>

      <div class="bg-neutral-50 rounded-xl p-4 border">
        <p class="font-semibold text-neutral-800 mb-2">ğŸ“ Data Files (Hot-Reloadable)</p>
        <p class="text-xs text-neutral-500 mb-3">Location: <code class="bg-neutral-100 px-1 rounded">RainbowAI/src/assistant/data/</code></p>
        <div class="overflow-x-auto">
          <table class="text-xs w-full border border-neutral-200 rounded-lg">
            <thead>
              <tr class="bg-neutral-50">
                <th class="text-left p-2">File</th>
                <th class="text-left p-2">Purpose</th>
                <th class="text-left p-2">Edited Via</th>
              </tr>
            </thead>
            <tbody class="text-neutral-700">
              <tr><td class="p-2 border-t font-mono">settings.json</td><td class="p-2 border-t">AI providers, routing, rate limits, staff phones</td><td class="p-2 border-t">Settings tab</td></tr>
              <tr><td class="p-2 border-t font-mono">intents.json</td><td class="p-2 border-t">Intent definitions, T1 regex patterns</td><td class="p-2 border-t">Intent Manager</td></tr>
              <tr><td class="p-2 border-t font-mono">intent-keywords.json</td><td class="p-2 border-t">T2 fuzzy keywords (en/ms/zh per intent)</td><td class="p-2 border-t">Intent Manager</td></tr>
              <tr><td class="p-2 border-t font-mono">intent-examples.json</td><td class="p-2 border-t">T3 semantic examples per intent</td><td class="p-2 border-t">Intent Manager</td></tr>
              <tr><td class="p-2 border-t font-mono">routing.json</td><td class="p-2 border-t">Intent â†’ action mapping</td><td class="p-2 border-t">Smart Routing tab</td></tr>
              <tr><td class="p-2 border-t font-mono">templates.json</td><td class="p-2 border-t">Response templates (multilingual)</td><td class="p-2 border-t">Responses tab</td></tr>
              <tr><td class="p-2 border-t font-mono">workflows.json</td><td class="p-2 border-t">Multi-step workflow definitions</td><td class="p-2 border-t">Workflows tab</td></tr>
              <tr><td class="p-2 border-t font-mono">knowledge.json</td><td class="p-2 border-t">Static replies + dynamic topic keys</td><td class="p-2 border-t">Legacy</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="bg-gradient-warning rounded-xl p-4 border border-warning-200">
        <p class="font-semibold text-warning-800 mb-2">ğŸ”„ Runtime Reload</p>
        <div class="bg-white rounded-lg p-3 border border-warning-200">
          <pre class="text-xs font-mono text-warning-800 whitespace-pre-wrap">// config-store.ts extends EventEmitter
configStore.on('reload', (domain) => {
  // domain: 'intents' | 'settings' | 'routing' | 'all'
  // Modules listen and reinitialize on relevant changes
});

// T2/T4 changes: hot-reload (no restart needed)
// T3 semantic changes: REQUIRES server restart
//   (embeddings need to be recomputed)</pre>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• 8. MCP TOOLS â•â•â• -->
  <div id="dev-mcp-tools" class="bg-white rounded-2xl border p-6 mb-6">
    <div class="flex items-center gap-2 mb-4">
      <span class="text-2xl">ğŸ”§</span>
      <h3 class="text-xl font-semibold text-neutral-800">MCP Tools (19 Total)</h3>
    </div>
    <div class="space-y-4 text-sm text-neutral-700">
      <p class="leading-relaxed">
        File: <code class="bg-neutral-100 px-1 rounded text-xs">RainbowAI/src/tools/registry.ts</code>.
        Rainbow exposes 19 MCP tools via JSON-RPC at <code class="bg-neutral-100 px-1 rounded text-xs">POST /mcp</code>.
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Guest Management -->
        <div class="bg-blue-50 rounded-xl p-4 border border-blue-200">
          <p class="font-semibold text-blue-800 mb-2">ğŸ‘¥ Guest Management (5)</p>
          <div class="text-xs font-mono text-blue-700 space-y-1">
            <p>pelangi_list_guests</p>
            <p>pelangi_get_guest</p>
            <p>pelangi_search_guests</p>
            <p>pelangi_check_in_guest</p>
            <p>pelangi_check_out_guest</p>
          </div>
        </div>

        <!-- Capsule Ops -->
        <div class="bg-green-50 rounded-xl p-4 border border-green-200">
          <p class="font-semibold text-green-800 mb-2">ğŸ¨ Capsule Operations (4)</p>
          <div class="text-xs font-mono text-green-700 space-y-1">
            <p>pelangi_list_capsules</p>
            <p>pelangi_get_occupancy</p>
            <p>pelangi_check_availability</p>
            <p>pelangi_update_capsule</p>
          </div>
        </div>

        <!-- Dashboard -->
        <div class="bg-purple-50 rounded-xl p-4 border border-purple-200">
          <p class="font-semibold text-purple-800 mb-2">ğŸ“Š Dashboard & Analytics (4)</p>
          <div class="text-xs font-mono text-purple-700 space-y-1">
            <p>pelangi_get_dashboard</p>
            <p>pelangi_get_overdue_guests</p>
            <p>pelangi_get_analytics</p>
            <p>pelangi_export_csv</p>
          </div>
        </div>

        <!-- Problems -->
        <div class="bg-amber-50 rounded-xl p-4 border border-amber-200">
          <p class="font-semibold text-amber-800 mb-2">ğŸ”§ Problem Tracking (4)</p>
          <div class="text-xs font-mono text-amber-700 space-y-1">
            <p>pelangi_list_problems</p>
            <p>pelangi_create_problem</p>
            <p>pelangi_update_problem</p>
            <p>pelangi_export_whatsapp_issues</p>
          </div>
        </div>

        <!-- WhatsApp -->
        <div class="bg-emerald-50 rounded-xl p-4 border border-emerald-200">
          <p class="font-semibold text-emerald-800 mb-2">ğŸ“± WhatsApp (2)</p>
          <div class="text-xs font-mono text-emerald-700 space-y-1">
            <p>pelangi_send_whatsapp</p>
            <p>pelangi_get_whatsapp_status</p>
          </div>
        </div>
      </div>

      <div class="bg-neutral-50 rounded-xl p-4 border">
        <p class="font-semibold text-neutral-800 mb-2">ğŸ“¡ MCP Protocol Example</p>
        <div class="bg-white rounded-lg p-3 border">
          <pre class="text-xs font-mono text-neutral-800 whitespace-pre-wrap">// Request
POST /mcp
{
  "jsonrpc": "2.0",
  "method": "tools/call",
  "params": {
    "name": "pelangi_get_occupancy",
    "arguments": {}
  },
  "id": 1
}

// Response
{
  "jsonrpc": "2.0",
  "result": {
    "content": [{ "type": "text", "text": "Occupancy: 75% ..." }]
  },
  "id": 1
}</pre>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• 9. ADMIN API â•â•â• -->
  <div id="dev-admin-api" class="bg-white rounded-2xl border p-6 mb-6">
    <div class="flex items-center gap-2 mb-4">
      <span class="text-2xl">ğŸ”Œ</span>
      <h3 class="text-xl font-semibold text-neutral-800">Admin API Reference</h3>
    </div>
    <div class="space-y-4 text-sm text-neutral-700">
      <p class="leading-relaxed">
        File: <code class="bg-neutral-100 px-1 rounded text-xs">RainbowAI/src/routes/admin/</code>.
        Base URL: <code class="bg-neutral-100 px-1 rounded text-xs">http://localhost:3002/api/rainbow/</code>
      </p>

      <div class="bg-gradient-danger rounded-xl p-4 border border-danger-200">
        <p class="font-semibold text-danger-800 mb-2">ğŸ” Authentication</p>
        <div class="text-xs text-danger-700 space-y-1">
          <p><strong>Localhost:</strong> Auto-allowed (no auth required)</p>
          <p><strong>Remote:</strong> Requires <code class="bg-danger-100 px-1 rounded">X-Admin-Key</code> header = <code class="bg-danger-100 px-1 rounded">RAINBOW_ADMIN_KEY</code> env var</p>
        </div>
      </div>

      <div class="bg-neutral-50 rounded-xl p-4 border">
        <p class="font-semibold text-neutral-800 mb-2">ğŸ“‹ Key Endpoints</p>
        <div class="bg-white rounded-lg p-3 border">
          <pre class="text-xs font-mono text-neutral-800 whitespace-pre-wrap"><strong>Health & System</strong>
GET  /health                         â†’ Server health check
POST /mcp                            â†’ JSON-RPC MCP endpoint

<strong>Configuration</strong>
GET  /api/rainbow/settings           â†’ Get all AI settings
PUT  /api/rainbow/settings           â†’ Update settings
GET  /api/rainbow/admin/config       â†’ Full system config

<strong>Intent Management</strong>
GET  /api/rainbow/intents            â†’ List all intents
PUT  /api/rainbow/intents            â†’ Update intent definitions
GET  /api/rainbow/intent-keywords    â†’ Get T2 keywords
PUT  /api/rainbow/intent-keywords    â†’ Update T2 keywords
GET  /api/rainbow/intent-examples    â†’ Get T3 examples
PUT  /api/rainbow/intent-examples    â†’ Update T3 examples

<strong>Routing & Workflows</strong>
GET  /api/rainbow/routing            â†’ Get routing rules
PUT  /api/rainbow/routing            â†’ Update routing
GET  /api/rainbow/workflows          â†’ List workflows
PUT  /api/rainbow/workflows          â†’ Update workflows

<strong>Knowledge Base</strong>
GET  /api/rainbow/kb/files           â†’ List KB topic files
GET  /api/rainbow/kb/files/:name     â†’ Read KB file content
PUT  /api/rainbow/kb/files/:name     â†’ Write KB file content

<strong>Testing & Chat</strong>
POST /api/rainbow/ai/chat            â†’ Test AI chat response
POST /api/rainbow/tests/run          â†’ Run chat simulator test

<strong>Conversations</strong>
GET  /api/rainbow/conversations      â†’ Chat logs / history

<strong>WhatsApp</strong>
GET  /api/rainbow/whatsapp/status    â†’ Connection status
POST /api/rainbow/whatsapp/send      â†’ Send WhatsApp message
GET  /api/rainbow/whatsapp/qr        â†’ Get QR code for pairing

<strong>Templates (Dashboard UI)</strong>
GET  /api/rainbow/templates/:name    â†’ Load HTML partial</pre>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• 10. WHATSAPP INTEGRATION â•â•â• -->
  <div id="dev-whatsapp" class="bg-white rounded-2xl border p-6 mb-6">
    <div class="flex items-center gap-2 mb-4">
      <span class="text-2xl">ğŸ“±</span>
      <h3 class="text-xl font-semibold text-neutral-800">WhatsApp Integration (Baileys)</h3>
    </div>
    <div class="space-y-4 text-sm text-neutral-700">
      <p class="leading-relaxed">
        File: <code class="bg-neutral-100 px-1 rounded text-xs">RainbowAI/src/lib/baileys-client.ts</code>.
        Uses <code class="bg-neutral-100 px-1 rounded text-xs">@whiskeysockets/baileys</code> for direct WhatsApp Web connection (no official API needed).
      </p>

      <div class="bg-gradient-primary rounded-xl p-4 border border-primary-200">
        <p class="font-semibold text-primary-800 mb-2">ğŸ”„ Connection Flow</p>
        <div class="text-xs text-primary-700 font-mono space-y-1">
          <p>1. Server starts â†’ Initialize Baileys instance</p>
          <p>2. Generate QR code â†’ Display at /admin/whatsapp-qr</p>
          <p>3. User scans with phone â†’ Authenticate</p>
          <p>4. Session saved to RainbowAI/auth/ (persistent)</p>
          <p>5. Auto-reconnect on server restart</p>
        </div>
      </div>

      <div class="bg-neutral-50 rounded-xl p-4 border">
        <p class="font-semibold text-neutral-800 mb-2">ğŸ“¨ Message Handler</p>
        <div class="bg-white rounded-lg p-3 border">
          <pre class="text-xs font-mono text-neutral-800 whitespace-pre-wrap">baileys.ev.on('messages.upsert', async (m) => {
  // For each incoming message:
  1. Extract text, sender phone, timestamp, pushName
  2. Skip non-text messages (images, stickers, etc.)
  3. Send to handleIncomingMessage(message)
  4. handleIncomingMessage runs 4-phase pipeline
  5. Send AI response back via WhatsApp
  6. Log to conversation history
});</pre>
        </div>
      </div>

      <div class="bg-gradient-warning rounded-xl p-4 border border-warning-200">
        <p class="font-semibold text-warning-800 mb-2">ğŸ“± Multi-Instance Support</p>
        <div class="text-xs text-warning-700 space-y-1">
          <p>Each WhatsApp number has a <strong>separate Baileys session</strong> stored in <code class="bg-warning-100 px-1 rounded">RainbowAI/auth/{instanceId}/</code></p>
          <p>Dashboard shows connection status of all instances</p>
          <p>Messages include <code class="bg-warning-100 px-1 rounded">instanceId</code> for routing</p>
        </div>
      </div>

      <div class="bg-gradient-success rounded-xl p-4 border border-success-200">
        <p class="font-semibold text-success-800 mb-2">ğŸ”§ 3 Response Modes</p>
        <div class="text-xs text-success-700 space-y-1">
          <p><strong>Autopilot:</strong> AI auto-replies to all messages without human review</p>
          <p><strong>Copilot:</strong> AI suggests responses, staff approves/edits before sending</p>
          <p><strong>Manual:</strong> AI disabled, staff writes all replies manually</p>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• 11. TYPES & VALIDATION â•â•â• -->
  <div id="dev-types" class="bg-white rounded-2xl border p-6 mb-6">
    <div class="flex items-center gap-2 mb-4">
      <span class="text-2xl">ğŸ“</span>
      <h3 class="text-xl font-semibold text-neutral-800">Types & Validation</h3>
    </div>
    <div class="space-y-4 text-sm text-neutral-700">
      <div class="bg-neutral-50 rounded-xl p-4 border">
        <p class="font-semibold text-neutral-800 mb-2">Core Types (RainbowAI/src/assistant/types.ts)</p>
        <div class="bg-white rounded-lg p-3 border">
          <pre class="text-xs font-mono text-neutral-800 whitespace-pre-wrap">// Incoming WhatsApp message
IncomingMessage {
  from: string;         // Phone number (e.g., "60123456789")
  text: string;         // Message text
  pushName: string;     // WhatsApp display name
  messageId: string;    // Unique message ID
  timestamp: number;    // Unix timestamp
  instanceId?: string;  // WhatsApp instance identifier
}

// Intent classification result
IntentResult {
  category: string;     // e.g., "wifi", "booking_inquiry"
  confidence: number;   // 0.0 - 1.0
  source: string;       // "regex" | "fuzzy" | "semantic" | "llm"
  entities?: Record&lt;string, any&gt;;  // Extracted entities
}

// Conversation state (per phone number)
ConversationState {
  phone: string;
  pushName: string;
  messages: ChatMessage[];         // Last 20 messages
  language: 'en' | 'ms' | 'zh';
  bookingState: BookingState | null;
  workflowState: WorkflowState | null;
  lastIntent: string | null;
  repeatCount: number;     // Same intent 3x â†’ escalate
  unknownCount: number;    // Unknown 3x â†’ escalate
  slots: Record&lt;string, any&gt;;  // { checkInDate, guests, ... }
  createdAt: number;
  lastActiveAt: number;    // TTL: 1 hour
}

// Booking state machine
BookingState {
  stage: 'dates' | 'guests' | 'capsule_type' | 'confirm';
  checkIn?: string;
  checkOut?: string;
  guests?: number;
  capsuleType?: string;
  priceBreakdown?: PriceBreakdown;
}</pre>
        </div>
      </div>

      <div class="bg-gradient-primary rounded-xl p-4 border border-primary-200">
        <p class="font-semibold text-primary-800 mb-2">ğŸ” Shared Schemas (shared/schema.ts)</p>
        <div class="text-xs text-primary-700 space-y-1">
          <p><strong>Drizzle tables:</strong> guests, capsules, problems, users, settings, guestTokens, expenseRecords</p>
          <p><strong>Zod validation:</strong> Runtime type checking on all API inputs</p>
          <p><strong>Pattern:</strong> schema-tables.ts (Drizzle definitions) + schema-validation.ts (Zod schemas)</p>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• 12. FILE TREE â•â•â• -->
  <div id="dev-file-tree" class="bg-white rounded-2xl border p-6 mb-6">
    <div class="flex items-center gap-2 mb-4">
      <span class="text-2xl">ğŸ“</span>
      <h3 class="text-xl font-semibold text-neutral-800">File Tree Reference</h3>
    </div>
    <div class="space-y-4 text-sm text-neutral-700">
      <div class="bg-neutral-50 rounded-xl p-4 border">
        <div class="bg-white rounded-lg p-3 border overflow-x-auto">
          <pre class="text-xs font-mono text-neutral-800 whitespace-pre-wrap">RainbowAI/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts                          â† Entry point
â”‚   â”œâ”€â”€ server.ts                         â† MCP protocol handler
â”‚   â”œâ”€â”€ assistant/
â”‚   â”‚   â”œâ”€â”€ message-router.ts             â† 4-phase pipeline orchestrator
â”‚   â”‚   â”œâ”€â”€ pipeline/
â”‚   â”‚   â”‚   â”œâ”€â”€ input-validator.ts        â† Phase 1: validate & prepare
â”‚   â”‚   â”‚   â”œâ”€â”€ state-executor.ts         â† Phase 2: active states
â”‚   â”‚   â”‚   â”œâ”€â”€ intent-classifier.ts      â† Phase 3: classify & route
â”‚   â”‚   â”‚   â””â”€â”€ response-processor.ts     â† Phase 4: process & send
â”‚   â”‚   â”œâ”€â”€ ai-client.ts                  â† AI barrel export
â”‚   â”‚   â”œâ”€â”€ ai-provider-manager.ts        â† Provider lifecycle & fallback
â”‚   â”‚   â”œâ”€â”€ ai-classification.ts          â† T4 LLM classification
â”‚   â”‚   â”œâ”€â”€ ai-utilities.ts              â† AI helper functions
â”‚   â”‚   â”œâ”€â”€ fuzzy-matcher.ts              â† T2 matching (Fuse.js)
â”‚   â”‚   â”œâ”€â”€ semantic-matcher.ts           â† T3 matching (embeddings)
â”‚   â”‚   â”œâ”€â”€ knowledge-base.ts             â† Progressive KB loading
â”‚   â”‚   â”œâ”€â”€ config-store.ts               â† Atomic config + EventEmitter
â”‚   â”‚   â”œâ”€â”€ conversation.ts               â† Conversation state machine
â”‚   â”‚   â”œâ”€â”€ workflow-executor.ts          â† Step & node-based workflows
â”‚   â”‚   â”œâ”€â”€ types.ts                      â† Type definitions
â”‚   â”‚   â””â”€â”€ data/                         â† JSON config files
â”‚   â”‚       â”œâ”€â”€ settings.json
â”‚   â”‚       â”œâ”€â”€ intents.json
â”‚   â”‚       â”œâ”€â”€ intent-keywords.json
â”‚   â”‚       â”œâ”€â”€ intent-examples.json
â”‚   â”‚       â”œâ”€â”€ routing.json
â”‚   â”‚       â”œâ”€â”€ templates.json
â”‚   â”‚       â”œâ”€â”€ workflows.json
â”‚   â”‚       â””â”€â”€ holidays.json
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ baileys-client.ts             â† WhatsApp connection
â”‚   â”‚   â”œâ”€â”€ http-client.ts                â† API calls to backend
â”‚   â”‚   â””â”€â”€ activity-tracker.ts           â† Error tracking
â”‚   â”œâ”€â”€ routes/admin/
â”‚   â”‚   â”œâ”€â”€ index.ts                      â† Route registration
â”‚   â”‚   â”œâ”€â”€ testing-preview.ts            â† Chat simulator endpoint
â”‚   â”‚   â””â”€â”€ http-utils.ts                 â† Error formatters
â”‚   â”œâ”€â”€ tools/
â”‚   â”‚   â”œâ”€â”€ registry.ts                   â† MCP tool registration
â”‚   â”‚   â”œâ”€â”€ guests.ts / guests-write.ts   â† Guest tools
â”‚   â”‚   â”œâ”€â”€ capsules.ts                   â† Capsule tools
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ public/
â”‚       â”œâ”€â”€ rainbow-admin.html            â† Dashboard SPA entry
â”‚       â”œâ”€â”€ css/                          â† Dashboard stylesheets
â”‚       â”œâ”€â”€ js/                           â† Dashboard modules
â”‚       â””â”€â”€ templates/tabs/               â† Tab HTML partials
â”‚
â”œâ”€â”€ .rainbow-kb/                          â† Knowledge base markdown
â”‚   â”œâ”€â”€ AGENTS.md, soul.md               â† Core files (always loaded)
â”‚   â”œâ”€â”€ checkin-*.md, pricing.md         â† Topic files
â”‚   â””â”€â”€ ...
â”œâ”€â”€ auth/                                 â† Baileys session data
â””â”€â”€ tests/                                â† Vitest test suites

server/
â”œâ”€â”€ index.ts                              â† Express bootstrap
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ guests.ts, capsules.ts           â† CRUD APIs
â”‚   â”œâ”€â”€ rainbow-kb.ts                    â† KB file CRUD
â”‚   â””â”€â”€ ...
â”œâ”€â”€ Storage/
â”‚   â”œâ”€â”€ StorageFactory.ts                â† DB vs in-memory selector
â”‚   â”œâ”€â”€ DatabaseStorage.ts               â† PostgreSQL (Drizzle)
â”‚   â””â”€â”€ MemStorage.ts                    â† In-memory fallback
â””â”€â”€ configManager.ts                      â† System configuration

client/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ App.tsx                           â† Route definitions
â”‚   â”œâ”€â”€ pages/                            â† Route components
â”‚   â”œâ”€â”€ components/ui/                    â† shadcn/ui components
â”‚   â””â”€â”€ lib/api.ts                        â† TanStack Query hooks

shared/
â”œâ”€â”€ schema.ts                             â† Barrel export
â”œâ”€â”€ schema-tables.ts                      â† Drizzle table definitions
â””â”€â”€ schema-validation.ts                  â† Zod validation schemas</pre>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• 13. COMMON TASKS â•â•â• -->
  <div id="dev-common-tasks" class="bg-white rounded-2xl border p-6 mb-6">
    <div class="flex items-center gap-2 mb-4">
      <span class="text-2xl">ğŸ› ï¸</span>
      <h3 class="text-xl font-semibold text-neutral-800">Common Development Tasks</h3>
    </div>
    <div class="space-y-4 text-sm text-neutral-700">

      <!-- Add Intent -->
      <div class="bg-blue-50 rounded-xl p-4 border border-blue-200">
        <p class="font-semibold text-blue-800 mb-2">ğŸ¯ Add a New Intent</p>
        <div class="text-xs text-blue-700 space-y-1">
          <p><strong>1.</strong> <code class="bg-blue-100 px-1 rounded">intents.json</code> â€” Add category + display name + description</p>
          <p><strong>2.</strong> <code class="bg-blue-100 px-1 rounded">intent-keywords.json</code> â€” Add T2 fuzzy keywords (en/ms/zh)</p>
          <p><strong>3.</strong> <code class="bg-blue-100 px-1 rounded">intent-examples.json</code> â€” Add T3 semantic example phrases</p>
          <p><strong>4.</strong> <code class="bg-blue-100 px-1 rounded">routing.json</code> â€” Map intent â†’ action (knowledge_base, workflow, template, escalate)</p>
          <p><strong>5.</strong> Test in Chat Simulator â†’ Verify tier matching and response</p>
          <p><strong>6.</strong> If using T3 examples: restart MCP server to reload embeddings</p>
        </div>
      </div>

      <!-- Create Workflow -->
      <div class="bg-green-50 rounded-xl p-4 border border-green-200">
        <p class="font-semibold text-green-800 mb-2">ğŸ”€ Create a Workflow</p>
        <div class="text-xs text-green-700 space-y-1">
          <p><strong>1.</strong> Add workflow definition to <code class="bg-green-100 px-1 rounded">workflows.json</code></p>
          <p><strong>2.</strong> Choose format: steps (linear) or nodes (branching)</p>
          <p><strong>3.</strong> Add routing rule: <code class="bg-green-100 px-1 rounded">{ "intent": "X", "action": "workflow", "workflow_id": "Y" }</code></p>
          <p><strong>4.</strong> Test via Workflow Tester or Chat Simulator</p>
        </div>
      </div>

      <!-- Add KB Topic -->
      <div class="bg-purple-50 rounded-xl p-4 border border-purple-200">
        <p class="font-semibold text-purple-800 mb-2">ğŸ“š Add KB Topic File</p>
        <div class="text-xs text-purple-700 space-y-1">
          <p><strong>1.</strong> Create <code class="bg-purple-100 px-1 rounded">.rainbow-kb/new-topic.md</code> with markdown content</p>
          <p><strong>2.</strong> Add regex pattern to <code class="bg-purple-100 px-1 rounded">knowledge-base.ts</code> â†’ <code class="bg-purple-100 px-1 rounded">guessTopicFiles()</code></p>
          <p><strong>3.</strong> Test: send message that should match â†’ verify KB content in response</p>
        </div>
      </div>

      <!-- Switch AI Provider -->
      <div class="bg-amber-50 rounded-xl p-4 border border-amber-200">
        <p class="font-semibold text-amber-800 mb-2">ğŸ¤– Switch / Add AI Provider</p>
        <div class="text-xs text-amber-700 space-y-1">
          <p><strong>1.</strong> Add/edit provider in <code class="bg-amber-100 px-1 rounded">settings.json</code> â†’ <code class="bg-amber-100 px-1 rounded">providers[]</code></p>
          <p><strong>2.</strong> Set <code class="bg-amber-100 px-1 rounded">enabled: true</code> and assign <code class="bg-amber-100 px-1 rounded">priority</code> (lower = tried first)</p>
          <p><strong>3.</strong> Add API key to <code class="bg-amber-100 px-1 rounded">.env</code> matching <code class="bg-amber-100 px-1 rounded">api_key_env</code> field</p>
          <p><strong>4.</strong> Dashboard â†’ Settings â†’ Verify provider shows "Configured"</p>
        </div>
      </div>

      <!-- Chat Simulator Screenshot -->
      <div class="rounded-xl overflow-hidden border border-neutral-200 shadow-soft">
        <img src="/public/images/help/chat-simulator.png" alt="Chat Simulator for Testing" class="w-full" loading="lazy">
        <div class="bg-neutral-50 px-3 py-1.5 text-xs text-neutral-500 text-center">Chat Simulator â€” test messages, see tier breakdown, and verify responses</div>
      </div>

      <!-- Debug Classification -->
      <div class="bg-neutral-50 rounded-xl p-4 border">
        <p class="font-semibold text-neutral-800 mb-2">ğŸ” Debug Intent Classification</p>
        <div class="bg-white rounded-lg p-3 border">
          <pre class="text-xs font-mono text-neutral-800 whitespace-pre-wrap"># Via Chat Simulator (dashboard)
Dashboard â†’ Test â†’ Chat Simulator â†’ type message â†’ see tier breakdown

# Via API
curl -X POST http://localhost:3002/api/rainbow/ai/chat \
  -H "Content-Type: application/json" \
  -d '{"message":"wifi password","language":"en"}'

# Check health
curl http://localhost:3002/health

# List all MCP tools
curl -X POST http://localhost:3002/mcp \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","method":"tools/list","id":1}'</pre>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• 14. TROUBLESHOOTING â•â•â• -->
  <div id="dev-troubleshooting" class="bg-white rounded-2xl border p-6 mb-6">
    <div class="flex items-center gap-2 mb-4">
      <span class="text-2xl">ğŸ”§</span>
      <h3 class="text-xl font-semibold text-neutral-800">Developer Troubleshooting</h3>
    </div>

    <!-- Performance Screenshot -->
    <div class="rounded-xl overflow-hidden border border-neutral-200 shadow-soft mb-4">
      <img src="/public/images/help/performance.png" alt="Performance Monitoring" class="w-full" loading="lazy">
      <div class="bg-neutral-50 px-3 py-1.5 text-xs text-neutral-500 text-center">Performance tab â€” monitor response times, tier distribution, and error rates</div>
    </div>

    <div class="space-y-3 text-sm">

      <div class="bg-gradient-danger rounded-xl p-4 border border-danger-200">
        <p class="font-semibold text-danger-800 mb-2">Dashboard shows "Loading..." forever</p>
        <ul class="text-xs text-danger-700 space-y-1 ml-4 list-disc">
          <li>Ensure all 3 ports are running: <code class="bg-danger-100 px-1 rounded">netstat -ano | findstr ":3000 :5000 :3002"</code></li>
          <li>Port 5000 is the most common missing one â€” MCP fetches data from it</li>
          <li>Hard refresh: <code class="bg-danger-100 px-1 rounded">Ctrl+Shift+R</code></li>
          <li>Clear Vite cache: <code class="bg-danger-100 px-1 rounded">rm -rf node_modules/.vite && npm run dev</code></li>
          <li>Quick fix: run <code class="bg-danger-100 px-1 rounded">start-all.bat</code> or <code class="bg-danger-100 px-1 rounded">check-health.bat</code></li>
        </ul>
      </div>

      <div class="bg-gradient-danger rounded-xl p-4 border border-danger-200">
        <p class="font-semibold text-danger-800 mb-2">Port already in use</p>
        <ul class="text-xs text-danger-700 space-y-1 ml-4 list-disc">
          <li><code class="bg-danger-100 px-1 rounded">npm run dev:clean</code> kills ports 3000/5000 before starting</li>
          <li>Manual: <code class="bg-danger-100 px-1 rounded">npx kill-port 3000 5000 3002</code></li>
        </ul>
      </div>

      <div class="bg-gradient-danger rounded-xl p-4 border border-danger-200">
        <p class="font-semibold text-danger-800 mb-2">T3 semantic not matching after editing examples</p>
        <ul class="text-xs text-danger-700 space-y-1 ml-4 list-disc">
          <li>T3 embeddings are computed <strong>once at startup</strong></li>
          <li>After changing <code class="bg-danger-100 px-1 rounded">intent-examples.json</code>, you <strong>must restart</strong> the MCP server</li>
          <li>T2 keywords and T4 LLM settings hot-reload (no restart needed)</li>
        </ul>
      </div>

      <div class="bg-gradient-danger rounded-xl p-4 border border-danger-200">
        <p class="font-semibold text-danger-800 mb-2">WhatsApp not connecting / QR not loading</p>
        <ul class="text-xs text-danger-700 space-y-1 ml-4 list-disc">
          <li>Phone must be online with internet</li>
          <li>QR codes expire after 60 seconds â€” refresh if needed</li>
          <li>Delete stale session: remove <code class="bg-danger-100 px-1 rounded">RainbowAI/auth/{instanceId}/</code> and restart</li>
          <li>Max 4 linked devices per WhatsApp account</li>
        </ul>
      </div>

      <div class="bg-gradient-danger rounded-xl p-4 border border-danger-200">
        <p class="font-semibold text-danger-800 mb-2">AI rate limited (429 error)</p>
        <ul class="text-xs text-danger-700 space-y-1 ml-4 list-disc">
          <li>Provider hit rate limit â€” fallback chain should auto-switch to next provider</li>
          <li>Check logs for which provider failed</li>
          <li>Add more providers to <code class="bg-danger-100 px-1 rounded">settings.json</code> for resilience</li>
          <li>Reduce T4 usage by adding more T2 keywords and T3 examples</li>
        </ul>
      </div>

      <div class="bg-gradient-danger rounded-xl p-4 border border-danger-200">
        <p class="font-semibold text-danger-800 mb-2">Config file corrupted / malformed JSON</p>
        <ul class="text-xs text-danger-700 space-y-1 ml-4 list-disc">
          <li><code class="bg-danger-100 px-1 rounded">config-store.ts</code> uses atomic writes (.tmp â†’ rename) â€” corruption is rare</li>
          <li>Restore from git: <code class="bg-danger-100 px-1 rounded">git checkout -- RainbowAI/src/assistant/data/settings.json</code></li>
          <li>Check .tmp files in data/ directory â€” may contain last valid state</li>
        </ul>
      </div>

      <div class="bg-gradient-danger rounded-xl p-4 border border-danger-200">
        <p class="font-semibold text-danger-800 mb-2">KB topic file not loading for specific queries</p>
        <ul class="text-xs text-danger-700 space-y-1 ml-4 list-disc">
          <li>Check <code class="bg-danger-100 px-1 rounded">guessTopicFiles()</code> regex in <code class="bg-danger-100 px-1 rounded">knowledge-base.ts</code></li>
          <li>Verify regex matches user's actual phrasing (test with regex101.com)</li>
          <li>Add new pattern or expand existing pattern to match the query</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- â•â•â• 15. DEPLOYMENT â•â•â• -->
  <div id="dev-deployment" class="bg-white rounded-2xl border p-6 mb-6">
    <div class="flex items-center gap-2 mb-4">
      <span class="text-2xl">ğŸš€</span>
      <h3 class="text-xl font-semibold text-neutral-800">Deployment & Environment</h3>
    </div>
    <div class="space-y-4 text-sm text-neutral-700">

      <div class="bg-neutral-50 rounded-xl p-4 border">
        <p class="font-semibold text-neutral-800 mb-2">ğŸ” Environment Variables</p>
        <div class="bg-white rounded-lg p-3 border">
          <pre class="text-xs font-mono text-neutral-800 whitespace-pre-wrap"><strong># Required (RainbowAI/.env or project root .env)</strong>
PELANGI_API_URL=https://pelangi.zeabur.app
PELANGI_API_TOKEN=your-admin-token
MCP_SERVER_PORT=3002

<strong># AI Providers (at least one required)</strong>
GEMINI_API_KEY=...
GROQ_API_KEY=...
OPENROUTER_API_KEY=...
MOONSHOT_API_KEY=...

<strong># Security</strong>
RAINBOW_ADMIN_KEY=your-admin-key    # Remote API access

<strong># Database (optional, falls back to in-memory)</strong>
DATABASE_URL=postgres://user:pass@host:5432/db</pre>
        </div>
      </div>

      <div class="bg-gradient-primary rounded-xl p-4 border border-primary-200">
        <p class="font-semibold text-primary-800 mb-2">ğŸ“¦ Deployment Targets</p>
        <div class="text-xs text-primary-700 space-y-1">
          <p><strong>Zeabur:</strong> Docker container + port mapping (primary target)</p>
          <p><strong>Railway:</strong> Node.js buildpack</p>
          <p><strong>Replit:</strong> REPL_ID env var auto-detection</p>
          <p><strong>Local:</strong> <code class="bg-primary-100 px-1 rounded">start-all.bat</code> or <code class="bg-primary-100 px-1 rounded">npm run dev:clean</code> + <code class="bg-primary-100 px-1 rounded">cd RainbowAI && npm run dev</code></p>
        </div>
      </div>

      <div class="bg-gradient-success rounded-xl p-4 border border-success-200">
        <p class="font-semibold text-success-800 mb-2">âš¡ Quick Start Commands</p>
        <div class="bg-white rounded-lg p-3 border border-success-200">
          <pre class="text-xs font-mono text-success-800 whitespace-pre-wrap"># Start all 3 servers (recommended)
start-all.bat

# Alternative: manual start
npm run dev:clean              # Frontend + Backend (ports 3000, 5000)
cd RainbowAI && npm run dev    # MCP server (port 3002)

# Verify servers
check-health.bat
# or: netstat -ano | findstr ":3000 :5000 :3002" | findstr "LISTENING"

# Run tests
cd RainbowAI && npm test

# Build for production
npm run build</pre>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="bg-gradient-primary rounded-2xl border p-6">
    <div class="flex items-center gap-2 mb-3">
      <span class="text-2xl">ğŸ“–</span>
      <h3 class="text-xl font-semibold text-neutral-800">Additional Documentation</h3>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-xs text-neutral-700">
      <div class="bg-white rounded-lg p-3 border">
        <p class="font-semibold mb-1">ğŸ“‹ Doc Index</p>
        <p><code class="bg-neutral-100 px-1 rounded">docs/INDEX.md</code> â€” Progressive disclosure guide to all docs</p>
      </div>
      <div class="bg-white rounded-lg p-3 border">
        <p class="font-semibold mb-1">ğŸ”Œ API Contract</p>
        <p><code class="bg-neutral-100 px-1 rounded">docs/API-CONTRACT.md</code> â€” Inter-module API reference</p>
      </div>
      <div class="bg-white rounded-lg p-3 border">
        <p class="font-semibold mb-1">ğŸ—ï¸ Architecture</p>
        <p><code class="bg-neutral-100 px-1 rounded">docs/System_Architecture_Document.md</code></p>
      </div>
      <div class="bg-white rounded-lg p-3 border">
        <p class="font-semibold mb-1">ğŸ¤– Rainbow AI</p>
        <p><code class="bg-neutral-100 px-1 rounded">RainbowAI/README.md</code> â€” Full Rainbow reference</p>
      </div>
      <div class="bg-white rounded-lg p-3 border">
        <p class="font-semibold mb-1">ğŸ”§ Troubleshooting</p>
        <p><code class="bg-neutral-100 px-1 rounded">docs/MASTER_TROUBLESHOOTING_GUIDE.md</code></p>
      </div>
      <div class="bg-white rounded-lg p-3 border">
        <p class="font-semibold mb-1">ğŸ“ CLAUDE.md</p>
        <p><code class="bg-neutral-100 px-1 rounded">CLAUDE.md</code> â€” AI coding agent context (this project)</p>
      </div>
    </div>
  </div>
