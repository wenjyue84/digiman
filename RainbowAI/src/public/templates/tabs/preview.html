    <div class="mb-4">
      <h2 class="text-lg font-semibold text-neutral-800">AI Agent Preview</h2>
      <p class="text-sm text-neutral-500">Test how the AI agent responds to guest messages in real-time</p>
    </div>

    <!-- Autotest Panel (hidden by default) -->
    <div id="autotest-panel" class="hidden">
      <!-- Autotest Header -->
      <div class="bg-indigo-50 border rounded-2xl p-4 mb-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <span class="text-2xl">üß™</span>
            <div>
              <h3 class="font-semibold text-neutral-800">Autotest Suite</h3>
              <p class="text-xs text-neutral-500"><span id="scenario-total-count">--</span> scenarios across <span id="scenario-category-count">--</span> categories</p>
            </div>
          </div>
          <div class="flex gap-2">
            <!-- View History Button -->
            <button id="view-history-btn" onclick="showAutotestHistory()" class="hidden text-sm bg-white border border-neutral-300 hover:bg-neutral-50 px-3 py-1.5 rounded-2xl transition flex items-center gap-1">
              <span>üìã</span>
              <span>History</span>
            </button>
            <!-- Export Report Dropdown -->
            <div id="export-report-dropdown" class="hidden relative">
              <button onclick="toggleExportDropdown()" class="text-sm bg-white border border-neutral-300 hover:bg-neutral-50 px-3 py-1.5 rounded-2xl transition flex items-center gap-1">
                Export Report
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </button>
              <div id="export-dropdown-menu" class="hidden absolute right-0 mt-1 w-72 bg-white border border-neutral-300 rounded-xl shadow-lg z-50">
                <button onclick="exportAutotestReport(lastAutotestResults, 'all')" class="w-full text-left text-sm px-4 py-2.5 hover:bg-neutral-50 transition flex items-center gap-2 rounded-t-xl">
                  <span class="text-lg">üìä</span>
                  <span>Export All Results</span>
                </button>
                <button onclick="exportAutotestReport(lastAutotestResults, 'warnings-failed')" class="w-full text-left text-sm px-4 py-2.5 hover:bg-neutral-50 transition flex items-center gap-2 border-t border-neutral-200">
                  <span class="text-lg">‚ö†Ô∏è</span>
                  <span>Export Warnings & Failed Only</span>
                </button>
                <button onclick="exportAutotestReport(lastAutotestResults, 'failed')" class="w-full text-left text-sm px-4 py-2.5 hover:bg-neutral-50 transition flex items-center gap-2 border-t border-neutral-200 rounded-b-xl">
                  <span class="text-lg">‚ùå</span>
                  <span>Export Failed Only</span>
                </button>
              </div>
              </div>
            <div class="flex items-center gap-1.5" title="Number of scenarios run at the same time. Higher = faster but may cause timeouts or rate limits. Default 6. Lower to 3‚Äì4 if you see many failures.">
              <label for="autotest-concurrency" class="text-xs text-neutral-500 whitespace-nowrap">Concurrent:</label>
              <input type="number" id="autotest-concurrency" min="1" max="20" value="6" class="w-12 text-sm text-center border border-neutral-300 rounded-lg px-1 py-1.5 bg-white" aria-label="Concurrent tests">
            </div>
            <button id="run-all-btn" onclick="runAutotest()" class="text-sm bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-1.5 rounded-2xl transition">Run All</button>
            <button id="stop-autotest-btn" onclick="stopAutotest()" class="hidden text-sm bg-red-500 hover:bg-red-600 text-white px-4 py-1.5 rounded-2xl transition">Stop</button>
            <button onclick="toggleAutotest()" class="text-sm bg-white border border-neutral-300 hover:bg-neutral-50 px-3 py-1.5 rounded-2xl transition">Back to Chat</button>
          </div>
        </div>
      </div>

      <!-- Summary Cards -->
      <div id="autotest-summary" class="grid grid-cols-5 gap-3 mb-4 hidden">
        <div class="bg-white border rounded-2xl p-3 text-center">
          <div class="text-2xl font-bold text-neutral-800" id="at-total">0</div>
          <div class="text-xs text-neutral-500">Total</div>
        </div>
        <div class="bg-white border rounded-2xl p-3 text-center">
          <div class="text-2xl font-bold text-green-600" id="at-passed">0</div>
          <div class="text-xs text-neutral-500">Passed</div>
        </div>
        <div class="bg-white border rounded-2xl p-3 text-center">
          <div class="text-2xl font-bold text-yellow-600" id="at-warnings">0</div>
          <div class="text-xs text-neutral-500">Warnings</div>
        </div>
        <div class="bg-white border rounded-2xl p-3 text-center">
          <div class="text-2xl font-bold text-red-600" id="at-failed">0</div>
          <div class="text-xs text-neutral-500">Failed</div>
        </div>
        <div class="bg-white border rounded-2xl p-3 text-center">
          <div class="text-2xl font-bold text-indigo-600" id="at-time">0s</div>
          <div class="text-xs text-neutral-500">Time</div>
        </div>
      </div>

      <!-- Progress Bar -->
      <div id="autotest-progress" class="hidden mb-4">
        <div class="flex items-center justify-between mb-2">
          <div class="flex items-center gap-3">
            <div class="animate-spin h-4 w-4 border-2 border-indigo-500 border-t-transparent rounded-full"></div>
            <span id="at-progress-text" class="text-sm text-neutral-600">Running...</span>
          </div>
          <div id="at-live-counters" class="flex items-center gap-3 text-xs font-medium">
            <span class="text-green-600"><span id="at-live-pass">0</span> Pass</span>
            <span class="text-yellow-600"><span id="at-live-warn">0</span> Warn</span>
            <span class="text-red-600"><span id="at-live-fail">0</span> Fail</span>
          </div>
        </div>
        <div class="w-full bg-neutral-200 rounded-full h-2">
          <div id="at-progress-bar" class="bg-indigo-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
        </div>
      </div>

      <!-- Results Container -->
      <div id="autotest-results" class="space-y-2" style="max-height: calc(100vh - 420px); overflow-y: auto;">
        <div class="text-center text-neutral-400 text-sm py-12">
          <p>Click "Run All" to execute <span id="scenario-count">0</span> test scenarios</p>
          <p class="text-xs mt-1">Tests check intent detection, multilingual support, edge cases, and more</p>
        </div>
      </div>
    </div>

    <!-- Autotest History Modal -->
    <div id="autotest-history-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white rounded-2xl p-6 max-w-4xl w-full mx-4 max-h-[80vh] overflow-hidden flex flex-col">
        <!-- Modal Header -->
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-xl font-semibold text-neutral-800">Test History</h3>
          <button onclick="closeAutotestHistory()" class="text-neutral-500 hover:text-neutral-700">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>

        <!-- History List -->
        <div id="autotest-history-list" class="flex-1 overflow-y-auto space-y-2">
          <div class="text-center text-neutral-400 text-sm py-12">
            <p>No test history yet</p>
            <p class="text-xs mt-1">Run tests to see results here</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ChatGPT-style Layout -->
    <div id="chat-layout" class="bg-white border rounded-2xl overflow-hidden flex" style="height: calc(100vh - 280px); min-height: 600px;">

      <!-- Sidebar: Chat Sessions -->
      <div class="w-64 border-r bg-neutral-50 flex flex-col">
        <!-- Sidebar Header -->
        <div class="px-4 py-3 border-b bg-white">
          <button onclick="createNewChat()" class="w-full bg-primary-500 hover:bg-primary-600 text-white px-3 py-2 rounded-2xl text-sm transition flex items-center justify-center gap-2">
            <span>‚ûï</span>
            <span>New Chat</span>
          </button>
        </div>

        <!-- Chat Sessions List -->
        <div id="chat-sessions" class="flex-1 overflow-y-auto p-2">
          <!-- Sessions will be populated here -->
        </div>

        <!-- Info Footer -->
        <div class="px-3 py-2 border-t text-xs text-neutral-500">
          <p class="font-medium mb-1">üí° Tips:</p>
          <p>‚Ä¢ Sessions auto-save</p>
          <p>‚Ä¢ Click to switch</p>
        </div>
      </div>

      <!-- Main Chat Area -->
      <div class="flex-1 flex flex-col">
        <!-- Chat Header -->
        <div class="bg-primary-50 border-b px-4 py-3 flex items-center justify-between">
          <div class="flex items-center gap-2">
            <span class="text-2xl">üí¨</span>
            <div>
              <h3 class="font-semibold text-neutral-800">Guest Simulation</h3>
              <p class="text-xs text-neutral-500">Messages use current Rainbow config</p>
            </div>
          </div>
          <div class="flex gap-2">
            <button id="view-history-btn-preview" onclick="showAutotestHistory()" class="text-sm bg-white border border-neutral-300 hover:bg-neutral-50 px-3 py-1.5 rounded-2xl transition flex items-center gap-1">
              <span>üìã</span>
              <span>History</span>
            </button>
            <button onclick="toggleAutotest()" class="text-sm bg-indigo-500 hover:bg-indigo-600 text-white px-3 py-1.5 rounded-2xl transition">Autotest</button>
            <button onclick="clearCurrentChat()" class="text-sm bg-white border border-neutral-300 hover:bg-neutral-50 px-3 py-1.5 rounded-2xl transition">Clear Chat</button>
          </div>
        </div>

        <!-- Chat Input (Right below header) -->
        <div class="border-b bg-white px-4 py-3">
          <form onsubmit="sendChatMessage(event)" class="flex gap-2">
            <input
              type="text"
              id="chat-input"
              placeholder="Type a guest message to test the AI agent..."
              class="flex-1 px-4 py-2 border border-neutral-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-primary-500"
              autocomplete="off"
            />
            <button type="submit" class="bg-primary-500 hover:bg-primary-600 text-white px-4 py-2 rounded-2xl transition flex items-center gap-2">
              <span>Send</span>
              <span>‚û§</span>
            </button>
          </form>
        </div>

        <!-- Chat Messages Container -->
        <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4 bg-neutral-50">
          <!-- Welcome message -->
          <div class="text-center text-neutral-500 text-sm py-8">
            <p class="text-2xl mb-2">üëã</p>
            <p class="font-medium mb-1">Welcome to AI Agent Preview</p>
            <p class="text-xs">Type a message to test how the AI responds</p>
          </div>
        </div>
      </div>
    </div>
